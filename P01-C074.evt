      * P01-C074.evt
      * P01-C074.evt is generated from T:\Transport\FONTES\TRABALHO\CTRC\P01-C074.Psf
      * This is a generated file. DO NOT modify this file directly.
      

       Acu-t1-Ta-1-Cmd-Tabchanged.
           EVALUATE Event-Type
           WHEN Cmd-Tabchanged
              MOVE Event-Data-1 TO t1-Ta-1-Value
              MOVE 0 TO t1-Pg-1-Visible, t1-Pg-2-Visible,
                  t1-Pg-4-Visible
              EVALUATE Event-Data-1
              WHEN 1
                 MOVE 1 TO t1-Pg-1-Visible
              WHEN 2
                 MOVE 1 TO t1-Pg-2-Visible
              WHEN 3
                 MOVE 1 TO t1-Pg-4-Visible
              END-EVALUATE
      *       Before-Tabchg-Display
              DISPLAY t1
              PERFORM t1-Ta-1-Aft-Tabchg-Display
           END-EVALUATE
           .

       t1-Exception-Proc.
           PERFORM t1-Ex-Other
           .

       t1-Gd-1-Event-Proc.
      * 
           EVALUATE Event-Type
           WHEN Msg-Begin-Entry
              EVALUATE Event-Control-Id
              WHEN 92
                 PERFORM t1-Gd-1-Ev-Msg-Begin-Entry
              WHEN 144
                 PERFORM t1-Gd-3-Ev-Msg-Begin-Entry
              WHEN 129
                 PERFORM t1-Gd-4-Ev-Msg-Begin-Entry
              END-EVALUATE
           WHEN Msg-Goto-Cell
              EVALUATE Event-Control-Id
              WHEN 92
                 PERFORM t1-Gd-1-Ev-Msg-Goto-Cell
              WHEN 144
                 PERFORM t1-Gd-3-Ev-Msg-Goto-Cell
              WHEN 129
                 PERFORM t1-Gd-4-Ev-Msg-Goto-Cell
              END-EVALUATE
           WHEN Msg-Goto-Cell-Mouse
              EVALUATE Event-Control-Id
              WHEN 92
                 PERFORM t1-Gd-1-Ev-Msg-Goto-Cell-Mouse
              WHEN 144
                 PERFORM t1-Gd-3-Ev-Msg-Goto-Cell-Mouse
              WHEN 129
                 PERFORM t1-Gd-4-Ev-Msg-Goto-Cell-Mouse
              END-EVALUATE
           END-EVALUATE
           .

       t2-Event-Proc.
           .

       t3-Event-Proc.
           .

       t6-Event-Proc.
           .

       t4-Event-Proc.
           .

       t5-Event-Proc.
           .

       t7-Event-Proc.
           .

       t8-Event-Proc.
           .
      ***   start event editor code   ***
      *
       arq-usu-Before-Open.
           move "\comp-3\ac-progr\programa\ARQ-USU.DAD" to drv-usu           
           .
      *
       arq-usu-prg-Before-Open.
           move "\comp-3\ac-progr\programa\ARQ-USU-PRG.DAD" 
                                                        to drv-usu-prg           
           .
      *
       arq-prg-Before-Open.
           move "\comp-3\ac-progr\programa\ARQ-PRG.DAT" to drv-prg           
           .
      *
       t1-Pb-grava-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-grava bitmap-handle = tripao2-bmp
           modify t1-pb-grava style         = pbs-framed
           modify t1-pb-grava bitmap-number = 1
           .
      *
       t1-Pb-grava-Aft-Procedure.
           modify t1-pb-grava bitmap-handle = tripao2-bmp
           modify t1-pb-grava bitmap-number = 1
           modify t1-pb-grava flat
           .
      *
       t1-Pb-desiste-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-desiste bitmap-handle = tripao2-bmp
           modify t1-pb-desiste style         = pbs-framed
           modify t1-pb-desiste bitmap-number = 2
           .
      *
       t1-Pb-desiste-Aft-Procedure.
           modify t1-pb-desiste bitmap-handle = tripao2-bmp
           modify t1-pb-desiste bitmap-number = 2
           modify t1-pb-desiste flat
           .
      *
       t1-Pb-exclui-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-exclui bitmap-handle = tripao2-bmp
           modify t1-pb-exclui style         = pbs-framed
           modify t1-pb-exclui bitmap-number = 3
           .
      *
       t1-Pb-exclui-Aft-Procedure.
           modify t1-pb-exclui bitmap-handle = tripao2-bmp
           modify t1-pb-exclui bitmap-number = 3
           modify t1-pb-exclui flat
           .
      *
       t1-Pb-cancela-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-cancela bitmap-handle = tripao2-bmp
           modify t1-pb-cancela style         = pbs-framed
           modify t1-pb-cancela bitmap-number = 4
           .
      *
       t1-Pb-cancela-Aft-Procedure.
           modify t1-pb-cancela bitmap-handle = tripao2-bmp
           modify t1-pb-cancela bitmap-number = 4
           modify t1-pb-cancela flat
           .
      *
       t1-Pb-primeiro-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-primeiro bitmap-handle = tripao1-bmp
           modify t1-pb-primeiro style         = pbs-framed
           modify t1-pb-primeiro bitmap-number = 1
           .
      *
       t1-Pb-primeiro-Aft-Procedure.
           modify t1-pb-primeiro bitmap-handle = tripao1-bmp
           modify t1-pb-primeiro bitmap-number = 1
           modify t1-pb-primeiro flat
           .
      *
       t1-Pb-anterior-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-anterior bitmap-handle = tripao1-bmp
           modify t1-pb-anterior style         = pbs-framed
           modify t1-pb-anterior bitmap-number = 2
           .
      *
       t1-Pb-anterior-Aft-Procedure.
           modify t1-pb-anterior bitmap-handle = tripao1-bmp
           modify t1-pb-anterior bitmap-number = 2
           modify t1-pb-anterior flat
           .
      *
       t1-Pb-proximo-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-proximo bitmap-handle = tripao1-bmp
           modify t1-pb-proximo style         = pbs-framed
           modify t1-pb-proximo bitmap-number = 3
           .
      *
       t1-Pb-proximo-Aft-Procedure.
           modify t1-pb-proximo bitmap-handle = tripao1-bmp
           modify t1-pb-proximo bitmap-number = 3
           modify t1-pb-proximo flat
           .
      *
       t1-Pb-ultimo-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-ultimo bitmap-handle = tripao1-bmp
           modify t1-pb-ultimo style         = pbs-framed
           modify t1-pb-ultimo bitmap-number = 4
           .
      *
       t1-Pb-ultimo-Aft-Procedure.
           modify t1-pb-ultimo bitmap-handle = tripao1-bmp
           modify t1-pb-ultimo bitmap-number = 4
           modify t1-pb-ultimo flat
           .
      *
       t1-Pb-relatorio-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t1-pb-relatorio bitmap-handle = tripao2-bmp
           modify t1-pb-relatorio style         = pbs-framed
           modify t1-pb-relatorio bitmap-number = 5
           .
      *
       t1-Pb-relatorio-Aft-Procedure.
           modify t1-pb-relatorio bitmap-handle = tripao2-bmp
           modify t1-pb-relatorio bitmap-number = 5
           modify t1-pb-relatorio flat
           .
      *
       t1-Pb-pesquisa-Link.
           if control-id = 14 |Código
              initialize REG-IFC01
      
              call 'VIEWVIX' using 'N' 'P01-C074' REG-IFC01
              cancel 'VIEWVIX'

              if IFC01-CODIGO > 0
                 modify t1-Ef-IFC01-CODIGO value IFC01-CODIGO
                 perform t1-Ef-IFC01-CODIGO-Aft-Procedure

                 initialize t1-Ta-1-Value
                            t1-Pg-1-Visible
                            t1-Pg-2-Visible
                            t1-Pg-4-Visible
                            key-status
      
                 move 1  to t1-Ta-1-Value
                            t1-Pg-1-Visible
      
                 display t1

                 inquire t1-Pb-grava id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if

           if control-id = 28 |Veículo
              initialize REG-VEI01
      
              call 'VIEWVIX' using 'N' 'PCTRCVEI' REG-VEI01
              cancel 'VIEWVIX'
      
              if VEI01-CODIGO not = spaces
                 move VEI01-CODIGO to IFC01-VEICULO
                 modify t1-Ef-IFC01-VEICULO value IFC01-VEICULO
              end-if
           end-if

           if control-id = 31 |Motorista
              call 'VIEWVIX' using 'N' 'PCTRCMOT' reg-mot01
              cancel 'VIEWVIX'
 
              if mot01-codigo > 0
                 move mot01-codigo to IFC01-CONDUTOR 
                 modify t1-Ef-IFC01-CONDUTOR value IFC01-CONDUTOR
              end-if
 
              inquire t1-Ef-IFC01-CONDUTOR id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           if control-id = 61 |Município Pg 2
              initialize REG-CID01
      
              call 'VIEWVIX' using 'N' 'PCTRC133' REG-CID01
              cancel 'VIEWVIX'
      
              if CID01-CODIGO > 0
                 move CID01-CODIGO to IFC01-MUNINFLACAO
                 modify t1-Ef-IFC01-MUNINFLACAO value IFC01-MUNINFLACAO
              end-if
           end-if

           if control-id = 81 |Código Pg 2
              initialize REG-IFC99
      
              call 'VIEWVIX' using 'N' 'P99-C117' REG-IFC99
              cancel 'VIEWVIX'
      
              if IFC99-CODIGO > 0
                 move IFC99-CODIGO to IFI01-CODINFLACAO
                 modify t1-Ef-IFI01-CODINFLACAO value IFI01-CODINFLACAO
              end-if
           end-if

           if control-id = 83 |Responsabilidade Pg 2
              move spaces to wrk-resp-vai
              perform acu-t3-routine
              
              if wrk-resp-vai not = spaces
                 move wrk-responsavel to IFI01-RESPONSABILIDADE
                 modify t1-Ef-IFI01-RESPONSABILIDADE 
                                            value IFI01-RESPONSABILIDADE
              else
                 move zeros to wrk-responsavel
              end-if

              inquire t1-Ef-IFI01-RESPONSABILIDADE id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           |Protocolo 54.544
           if control-id = 67 |Orgão Autuador Pg 2
              initialize REG-FOR15
      
              call 'VIEWVIX' using 'N' 'PESTOFOR' REG-FOR15
              cancel 'VIEWVIX'
      
              if FOR15-CODIGO > 0
                 move FOR15-CODIGO to IFC01-ORG-AUTUADOR
                 modify t1-Ef-IFC01-ORG-AUTUADOR 
                                                value IFC01-ORG-AUTUADOR
              end-if
           end-if
           |Fim Protocolo 54.544

           |Protocolo 54.601
           If control-id = 169 |Auto Infração Anterior
              Initialize REG-IFC01


              Call 'VIEWVIX' using '4' 'P01-C074' REG-IFC01
              Cancel 'VIEWVIX'
      
              If IFC01-CODIGO > 0
                 Move IFC01-AUTINFLACAO to IFC01-AUTINFLACAO-ANT
                 Modify t1-Ef-wrk-aut-ant value IFC01-AUTINFLACAO-ANT
              End-if
           End-if
           |Fim Protocolo 54.601
           .
      *
       t1-Pb-inclui-Link.
           evaluate control-id     
             when 28  |Veículo
                Call "P99-C019" using lnk-padrao
                Cancel "P99-C019"
             when 31  |Motorista
                Call "P99-C018" using lnk-padrao
                Cancel "P99-C018"
             when 61  |Município Pg 2
                Call "P99-C017" using lnk-padrao
                Cancel "P99-C017"
             when 81  |Código Pg 2
                Call "P99-C117" using lnk-padrao
                Cancel "P99-C117"
             when 97  |Município Pg 3
                Call "P99-C017" using lnk-padrao
                Cancel "P99-C017"
             when 103 |Tipo Pg 3
                Call "P99-C118" using lnk-padrao
                Cancel "P99-C118"
             |Protocolo 54.544
             when 67 |Orgão Autuador Pg 2
                move 'PESTO144' to wrk-programa-chamar
                perform Chama-Programa
             |Fim Protocolo 54.544
           end-evaluate
           .
      *
       t1-Pb-primeiro-Link.
           initialize REG-IFC01
           move low-value to IFC01-CODIGO
           start ARQ-IFC01 key is >= IFC01-CHAVE
           read ARQ-IFC01 next with lock
           if stat-ARQ-IFC01 = "99"
              move "Registro bloqueado por outro usuário." 
                                                        to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-CODIGO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           if not valid-ARQ-IFC01
              move "Nenhum registro encontrado." to wrk-message-1
              perform mensagem
              exit paragraph
           end-if
           perform t1-Ef-IFC01-CODIGO-Aft-Procedure
           perform t1-Ta-1-Aft-Tabchg-Display

           move "A" to wrk-acaexe
           
           inquire t1-Ef-IFC01-CODIGO id in control-id
           move 4 to accept-control
           exit paragraph
           .
      *
       t1-Pb-anterior-Link.
           start ARQ-IFC01 key is < IFC01-CHAVE
           read ARQ-IFC01 previous with lock
           if stat-ARQ-IFC01 = "99"
              move "Registro bloqueado por outro usuário." 
                                                        to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-CODIGO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           if stat-ARQ-IFC01 = "10" or "46"
              move "Primeiro registro cadastrado." to wrk-message-1
              perform mensagem
              exit paragraph
           end-if
           perform t1-Ef-IFC01-CODIGO-Aft-Procedure
           perform t1-Ta-1-Aft-Tabchg-Display

           move "A" to wrk-acaexe
           
           inquire t1-Ef-IFC01-CODIGO id in control-id
           move 4 to accept-control
           exit paragraph
           .
      *
       t1-Pb-proximo-Link.
           start ARQ-IFC01 key is > IFC01-CHAVE
           read ARQ-IFC01 next with lock
           if stat-ARQ-IFC01 = "99"
              move "Registro bloqueado por outro usuário." 
                                                        to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-CODIGO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           if stat-ARq-IFC01 = "10" or "46"
              move "Último registro cadastrado." to wrk-message-1
              perform mensagem
              exit paragraph
           end-if
           perform t1-Ef-IFC01-CODIGO-Aft-Procedure
           perform t1-Ta-1-Aft-Tabchg-Display

           move "A" to wrk-acaexe

           inquire t1-Ef-IFC01-CODIGO id in control-id
           move 4 to accept-control
           exit paragraph
           .
      *
       t1-Pb-ultimo-Link.
           move high-value to IFC01-CODIGO
           start ARQ-IFC01 key is < IFC01-CHAVE
           read ARQ-IFC01 previous with lock
           if stat-ARQ-IFC01 = "99"
              move "Registro bloqueado por outro usuário."
                                                        to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-CODIGO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           if not valid-ARQ-IFC01
              move "Registro não encontrado." to wrk-message-1
              perform mensagem
              exit paragraph
           end-if
           perform t1-Ef-IFC01-CODIGO-Aft-Procedure
           perform t1-Ta-1-Aft-Tabchg-Display

           move "A" to wrk-acaexe

           inquire t1-Ef-IFC01-CODIGO id in control-id
           move 4 to accept-control
           exit paragraph
           .
      *
       t1-Pb-relatorio-Link.
           perform acu-r1-preview    
           .
      *
       t1-Ex-Other.
           if key-status = 27
              if t1-Ta-1-Value = 1 
                 if control-id = 14
                    Close T01-C074-3
                    Call 'C$DELETE' using DRV-T01-C074-3, 'I'

                    Close T01-C074-4
                    Call 'C$DELETE' using DRV-T01-C074-4, 'I'

                    Close T01-C074-5
                    Call 'C$DELETE' using DRV-T01-C074-5, 'I'

                    set exit-pushed to true
                    exit paragraph
                 end-if
              
                 perform inicio

                 initialize key-status
                 inquire t1-Ef-IFC01-CODIGO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              if t1-Ta-1-Value = 2 or 3 or 4 or 5
                 perform inicio

                 Close T01-C074-3
                 Call 'C$DELETE' using DRV-T01-C074-3, 'I'

                 Close T01-C074-4
                 Call 'C$DELETE' using DRV-T01-C074-4, 'I'

                 Close T01-C074-5
                 Call 'C$DELETE' using DRV-T01-C074-5, 'I'
                 
                 initialize t1-Ta-1-Value
                            t1-Pg-1-Visible
                            t1-Pg-2-Visible
                            t1-Pg-4-Visible
                            key-status

                 move 1  to t1-Ta-1-Value
                            t1-Pg-1-Visible
   
                 display t1
   
                 inquire t1-Ef-IFC01-CODIGO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if
           .
      *
       t1-Aft-Initdata.
           move 01 to wrk-prgantnovo
           if ext-codusu is not numeric or
              ext-codusu = zeros
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              move "Usuário não encontrado" to wrk-message-1
              set wrk-warning-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
              set exit-pushed to true
           end-if
      *    ler o usuario para montar a barra inferior
           initialize reg-usu
           move ext-codusu to usu-codigo
           read arq-usu with no lock
           if valid-arq-usu
              string "Usuário: " usu-nome 
                                   delimited by size into wrk-barusuario
              modify t1-St-1-Handle panel-index 1
                                               panel-text wrk-barusuario

              initialize reg-emp00
              move 1 to emp00-codigo
              read arq-emp00 with no lock
              if valid-arq-emp00
                 Move emp00-nome to wrk-barempresa
              else
                 string "Empresa não encontrada"
                                   delimited by size into wrk-barempresa
              end-if
                 modify t1-St-1-Handle panel-index 2 
                                               panel-text wrk-barempresa
           end-if

      *    antes de checar as permissoes do usuario, tem que passar o 
      *    nome do programa para a work ex: "p00-c001" 
           move "P01-C074" to wrk-codprg
      *     perform checa-permissao
           copy "checa-permissao.cpy".  
         
           perform inicio
           .
      *
       trata-barra-funcoes.
           move 1 to wrk-prgantnovo
           modify t1-pb-pesquisa enabled 0
           modify t1-pb-inclui   enabled 0

           if control-id = 14  or 28 or 31 or 61 or 67 or 81 or 83 or 97 
                        or 103 or 125 or 169
              modify t1-pb-pesquisa enabled 1
           end-if

           if control-id = 28 or 31 or 61 or 67 or 81 or 97 or 103
              modify t1-pb-inclui   enabled 1
           end-if
           .
      *
       monta-tela.
           modify t1-Pb-anterior,   FLAT
           modify t1-Pb-cancela,    FLAT
           modify t1-Pb-desiste,    FLAT
           modify t1-Pb-exclui,     FLAT
           modify t1-Pb-grava,      FLAT
           modify t1-pb-help,       FLAT
           modify t1-Pb-inclui,     FLAT
           modify t1-pb-informacao, FLAT
           modify t1-Pb-pesquisa,   FLAT
           modify t1-Pb-primeiro,   FLAT
           modify t1-Pb-proximo,    FLAT
           modify t1-Pb-relatorio,  FLAT
           modify t1-Pb-ultimo,     FLAT

           display t1
           .
      *
       r1-RwEf-wrk-usuario-BeforePrint.
           initialize reg-usu
           move ext-codusu to usu-codigo
           perform acu-ds-arq-usu-Read
           if usu-login not = spaces
              move usu-login to wrk-loginusuario
           end-if           
           .
      *
       r1-RwEf-wrk-pagina-BeforePrint.
           move acu-pagenum to wrk-pagina            
           .
      *
       t1-pb-informacao-Link.
           move "P01-C074"       to    wrk-codprg
           call   "rot-0084.acu" using wrk-codprg
           cancel "rot-0084.acu"           
           .
      *
       t1-pb-help-Link.
           move "P01-C074"      to    wrk-codprg
           call   "rot-hlp.acu" using wrk-codprg
           cancel "rot-hlp.acu"                      
           .
      *
       t1-Bef-Initdata.                     
           move 1 to  wrk-prgantnovo
           .
      *
       call-error.
           move 1 to  wrk-prgantnovo
           initialize wrk-texto-msg
           string "Programa ( " wrk-codprg " ) não encontrado !" 
                                    delimited by size into wrk-message-1
           set wrk-warning-type to true
           set wrk-ok-type      to true
           call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                             wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           cancel "mensagem"
           .       


      *
       t1-Bef-Create.
           set environment "translate_to_ansi" to 0 
           .
      *
       t1-Aft-Create.
           copy "rot-log.cpy".
           .
      *
       Chama-Programa.
      *    Verifica o código do programa passado, para ver se chama o
      *    programa antigo ou o novo.
	        initialize reg-prg
           move wrk-programa-chamar to prg-codant

           start arq-prg key is >= chave-prg-codant

           if not valid-arq-prg
              move 1 to wrk-prgantnovo
              initialize wrk-texto-msg
              string "Programa " wrk-programa-chamar " não encontrado"
                                                      into wrk-message-1

              set wrk-warning-type to true
              set wrk-ok-type      to true

              call "mensagem" using wrk-Message-Type, wrk-Response-Type,
                                    wrk-Message-1, wrk-Message-2,
                                    wrk-Message-3
              on overflow perform call-error end-call
              cancel "mensagem"

              exit paragraph
           end-if

           read arq-prg next

           if valid-arq-prg

      *       Se o prg-usacodnv = 1, então chama o programa pelo código novo
      *       senão, usa o antigo mesmo
              if prg-usacodnv = 1
                 string prg-codigo ".acu" into wrk-chamaprog

                 call wrk-chamaprog using lnk-padrao
                 cancel wrk-chamaprog                 
              else
                 string prg-codant ".acu" into wrk-chamaprog

                 set environment "TRANSLATE_TO_ANSI" to 1

                 call wrk-chamaprog using lnk-padrao
                 cancel wrk-chamaprog
                 
                 set environment "TRANSLATE_TO_ANSI" to 0
              end-if
           end-if
           .
      *
       t1-Ef-IFS01-DATSITUACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-VEICULO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-CONDUTOR-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-CODIGO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-AUTINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-DATINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-HORINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFI01-NOTIFICACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-LOCINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-MUNINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-AGEINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-ORG-AUTUADOR-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Fr-3a-Cm-1-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFI01-CODINFLACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFI01-RESPONSABILIDADE-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFR01-DATRECURSO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFR01-CODRECURSO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFR01-ORGJULGADOR-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFR01-MUNJULGADOR-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-wrk-obs-1-r-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-wrk-obs-2-r-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-wrk-obs-3-r-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-wrk-obs-4-r-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFM01-DATLANCAMENTO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFM01-TIPO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFM01-CAMINHO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-HORSITUACAO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-TIPO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-OBSERVACAO1-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-OBSERVACAO2-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-OBSERVACAO3-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-OBSERVACAO4-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFS01-OBSERVACAO5-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Pb-Inclui-Pg2-Bef-Procedure.
           perform trata-barra-funcoes
           modify t1-Pb-Inclui-Pg2 bitmap-handle = tripao2-bmp
           modify t1-Pb-Inclui-Pg2 style         = pbs-framed
           modify t1-Pb-Inclui-Pg2 bitmap-number = 20
           .
      *
       t1-Pb-Inclui-Pg2-Aft-Procedure.
           modify t1-Pb-Inclui-Pg2 bitmap-handle = tripao2-bmp
           modify t1-Pb-Inclui-Pg2 bitmap-number = 20
           modify t1-Pb-Inclui-Pg2 flat
           .
      *
       t1-Pb-Exclui-Pg2-Bef-Procedure.
           perform trata-barra-funcoes
           modify t1-Pb-Exclui-Pg2 bitmap-handle = tripao2-bmp
           modify t1-Pb-Exclui-Pg2 style         = pbs-framed
           modify t1-Pb-Exclui-Pg2 bitmap-number = 10
           .
      *
       t1-Pb-Exclui-Pg2-Aft-Procedure.
           modify t1-Pb-Exclui-Pg2 bitmap-handle = tripao2-bmp
           modify t1-Pb-Exclui-Pg2 bitmap-number = 10
           modify t1-Pb-Exclui-Pg2 flat
           .
      *
       t1-Pb-Inclui-Pg4-Bef-Procedure.
           perform trata-barra-funcoes
           modify t1-Pb-Inclui-Pg4 bitmap-handle = tripao2-bmp
           modify t1-Pb-Inclui-Pg4 style         = pbs-framed
           modify t1-Pb-Inclui-Pg4 bitmap-number = 20
           .
      *
       t1-Pb-Inclui-Pg4-Aft-Procedure.
           modify t1-Pb-Inclui-Pg4 bitmap-handle = tripao2-bmp
           modify t1-Pb-Inclui-Pg4 bitmap-number = 20
           modify t1-Pb-Inclui-Pg4 flat
           .
      *
       t1-Pb-Exclui-Pg4-Bef-Procedure.
           perform trata-barra-funcoes
           modify t1-Pb-Exclui-Pg4 bitmap-handle = tripao2-bmp
           modify t1-Pb-Exclui-Pg4 style         = pbs-framed
           modify t1-Pb-Exclui-Pg4 bitmap-number = 10
           .
      *
       t1-Pb-Exclui-Pg4-Aft-Procedure.
           modify t1-Pb-Exclui-Pg4 bitmap-handle = tripao2-bmp
           modify t1-Pb-Exclui-Pg4 bitmap-number = 10
           modify t1-Pb-Exclui-Pg4 flat
           .

       Inicio.
           if wrk-acaexe = 'A'
              move LNK-IFC01-CODIGO to wrk-codigo-ifc
           end-if

           initialize REG-IFC01
                      REG-IFI01
                      REG-IFM01
                      REG-IFR01
                      REG-IFS01

           move spaces to wrk-marca-nome
                          wrk-IFC01-CONDUTOR
                          wrk-IFC01-PROPRIETARIO
                          wrk-munic-nome
                          wrk-rg
                          wrk-uf-pg1
                          wrk-IFC01-MUNINFLACAO
                          wrk-IFI01-CODINFLACAO
                          wrk-artigo
                          wrk-IFI01-RESPONSABILIDADE
                          wrk-IFR01-CODRECURSO
                          wrk-IFR01-MUNJULGADOR
                          wrk-uf-pg3
                          wrk-obs-1-r
                          wrk-obs-2-r
                          wrk-obs-3-r
                          wrk-obs-4-r
                          wrk-IFS01-TIPO
                          wrk-pergunta-btn
                          wrk-assinada
                          wrk-IFC01-ORG-AUTUADOR
                          wrk-nom-for
                          wrk-resp1
                          wrk-resp2
                          wrk-erro-btn-gravar
                          wrk-pagamento
                          wrk-NroTit 
                          wrk-pago   
                          wrk-dt-pgto

           move zeros  to wrk-marca-cod
                          wrk-munic-cod 
                          wrk-cpf
                          wrk-contagem-gd1
                          wrk-contagem-gd2
                          wrk-contagem-gd3
                          wrk-contagem-gd4
                          wrk-contagem-gd5
                          wrk-codigo-ifc
                          wrk-cod-for
                          wrk-nro-aut
                          wrk-total-pagar
                          wrk-total-infracao
                          wrk-cod-ant

           accept wrk-data-inv from date YYYYMMDD

           move wrk-data-inv-r-dia to IFC01-DATLANCAMENTO-R-DIA
                                      IFC01-DATINFLACAO-R-DIA
                                      IFR01-DATRECURSO-R-DIA
                                      IFM01-DATLANCAMENTO-R-DIA
                                      IFS01-DATSITUACAO-R-DIA

           move wrk-data-inv-r-mes to IFC01-DATLANCAMENTO-R-MES
                                      IFC01-DATINFLACAO-R-MES
                                      IFR01-DATRECURSO-R-MES
                                      IFM01-DATLANCAMENTO-R-MES
                                      IFS01-DATSITUACAO-R-MES

           move wrk-data-inv-r-ano to IFC01-DATLANCAMENTO-R-ANO
                                      IFC01-DATINFLACAO-R-ANO
                                      IFR01-DATRECURSO-R-ANO
                                      IFM01-DATLANCAMENTO-R-ANO
                                      IFS01-DATSITUACAO-R-ANO

           accept wrk-hora-lancamento from time 
           compute wrk-hora-lancamento = wrk-hora-lancamento / 1000000
           move wrk-hora-lancamento to IFC01-HORLANCAMENTO
                                       IFC01-HORINFLACAO
                                       IFS01-HORSITUACAO

           modify t1-Pb-relatorio enabled false
           modify t1-Pb-cancela   enabled false

           display t1

           perform Limpa-Grid-Pg2
           perform Limpa-Grid-Pg4
           perform Limpa-Grid-Pg5

           perform Atualiza-Pg-2
           perform Atualiza-Pg-4
           
           if LNK-IFC01-CODIGO > 0
              move "A" to wrk-acaexe
           else
              move "I" to wrk-acaexe

              |Protocolo 54.609
              move 'Lançada' to wrk-IFS01-TIPO
              modify t1-Ef-wrk-IFS01-TIPO value wrk-IFS01-TIPO

              modify t1-Ef-IFS01-OBSERVACAO1 enabled true
              modify t1-Ef-IFS01-OBSERVACAO2 enabled true
              modify t1-Ef-IFS01-OBSERVACAO3 enabled true
              modify t1-Ef-IFS01-OBSERVACAO4 enabled true
              modify t1-Ef-IFS01-OBSERVACAO5 enabled true
              |Fim
           end-if

           |Protocolo 54.601
           move 1 to wrk-tipo-combobox

           move t1-Cm-2-Container(wrk-tipo-combobox) to t1-Cm-2-Value
           modify t1-Cm-1-Tipo VALUE t1-Cm-2-Value 
           |Fim

           if LNK-IFC01-CODIGO > 0
              move LNK-IFC01-CODIGO to IFC01-CODIGO
              perform t1-Ef-IFC01-CODIGO-Aft-Procedure
              move zeros to LNK-IFC01-CODIGO

              |Protocolo 54.781
              initialize REG-IFP01
              move IFC01-CODIGO to IFP01-CODIGO
              move low-value    to IFP01-PROGRESSIVO
              start ARQ-IFP01 key is >= IFP01-CHAVE
              read ARQ-IFP01 next with no lock
              if valid-ARQ-IFP01 and IFC01-CODIGO = IFP01-CODIGO
                 if IFP01-AUTORIZACAO is not numeric or 
                    IFP01-AUTORIZACAO = zeros
                    move 'Não' to wrk-pago
                 else
                    move IFP01-AUTORIZACAO to wrk-NroTit

                    initialize REG-VEI01
                    move IFC01-VEICULO to VEI01-CODIGO
                    read ARQ-VEI01 with no lock
                    if not valid-ARQ-VEI01
                       initialize REG-VEI01
                    end-if
         
                    initialize REG-UNI15
                    move VEI01-UN-NEG to UNI15-CODIGO
                    read ARQ-UNI15 with no lock
                    if not valid-ARQ-UNI15
                       initialize REG-UNI15
                    end-if

                    initialize REG-PAG09
                    if UNI15-EMP-PED-COMPRAS > 0
                       move UNI15-EMP-PED-COMPRAS to Pag09-CODEMP
                    else
                       move 1 to Pag09-CODEMP
                    end-if

                    move IFC01-ORG-AUTUADOR to Pag09-CODFOR
                    move IFP01-NROTIT       to Pag09-NROTIT
                    move IFP01-DESTIT       to Pag09-DESTIT
                    read ARQ-PAG09 with no lock
                    if valid-ARQ-PAG09
                       if Pag09-SALTIT <> 0
                          move 'Não' to wrk-pago
                       else
                          move 'Sim' to wrk-pago

                          initialize REG-BAI09
                          move Pag09-CODEMP to Bai09-CODEMP
                          move Pag09-CODFOR to Bai09-CODFOR
                          move Pag09-NROTIT to Bai09-NROTIT
                          move Pag09-DESTIT to Bai09-DESTIT
                          move low-value    to Bai09-NUMERO
                          start ARQ-BAI09 key is >= Bai09-CHAVE
                          read ARQ-BAI09 next with no lock
                          if valid-ARQ-BAI09
                             string Bai09-DIAMOV '/'
                                    Bai09-MESMOV '/'
                                    Bai09-ANOMOV
                                    into wrk-dt-pgto
                          end-if
                       end-if
                    end-if
                 end-if
              end-if

              modify t1-Ef-wrk-NroTit  value wrk-NroTit
              modify t1-Ef-wrk-pago    value wrk-pago
              modify t1-Ef-wrk-dt-pgto value wrk-dt-pgto
              |Fim
           end-if
           .

       Limpa-Grid-Pg2.
           modify t1-Gd-1, RESET-GRID 1
           move Zeros to wrk-linha-grid-1
           Add 1 to wrk-linha-grid-1
           modify t1-Gd-1, NUM-ROWS wrk-linha-grid-1
           Perform Acu-t1-Gd-1-Content
           .

       Limpa-Grid-Pg4.
           modify t1-Gd-3, RESET-GRID 1
           move Zeros to wrk-linha-grid-3
           Add 1 to wrk-linha-grid-3
           modify t1-Gd-3, NUM-ROWS wrk-linha-grid-3
           Perform Acu-t1-Gd-3-Content
           .

       Limpa-Grid-Pg5.
           modify t1-Gd-4, RESET-GRID 1
           move Zeros to wrk-linha-grid-4
           Add 1 to wrk-linha-grid-4
           modify t1-Gd-4, NUM-ROWS wrk-linha-grid-4
           Perform Acu-t1-Gd-4-Content
           .

       Mensagem.
           move 1 to  wrk-prgantnovo
           set wrk-warning-type to true
           set wrk-ok-type      to true
           Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                         wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem" 
           .

       Mensagem-i.
           move 1 to  wrk-prgantnovo
           set wrk-information-type to true
           set wrk-ok-type      to true
           Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                         wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem"
           .
      *
       t1-Gd-1-Ev-Msg-Begin-Entry.
           Set Event-Action to Event-Action-Fail
           .
      *
       t1-Gd-1-Ev-Msg-Goto-Cell.
           modify t1-Gd-1, Start-X 1
                                 X 7
                           Start-Y event-data-2
                                 Y event-data-2
                           Region-Color 80

           move zeros to wrk-progressivo-gd-1

           inquire t1-Gd-1 (event-data-2, 1) hidden-data 
                                                 in wrk-progressivo-gd-1  

           initialize REG-T01-C074-5
           move wrk-codigo-ifc       to T01-C074-5-CODIGO-IFC
           move wrk-progressivo-gd-1 to T01-C074-5-PROGRESSIVO
           read T01-C074-5 with no lock
           if not valid-T01-C074-5
              initialize REG-T01-C074-5
           end-if
           move T01-C074-5-CODIGO           to IFI01-CODINFLACAO
           move T01-C074-5-DESCRICAO        to wrk-IFI01-CODINFLACAO
           move T01-C074-5-RESPONSABILIDADE to IFI01-RESPONSABILIDADE
           move T01-C074-5-ARTIGO           to IFI01-ARTIGO
           move T01-C074-5-PONTUACAO        to IFI01-PONTOS
           move T01-C074-5-VALOR            to IFI01-VALOR
           move T01-C074-5-ARTIGO           to IFI01-ARTIGO
           move T01-C074-5-MEDREALIZADA     to IFI01-MEDREALIZADA

           evaluate IFI01-RESPONSABILIDADE
              when 1
                 move "Condutor"     to wrk-IFI01-RESPONSABILIDADE
              when 2
                 move "Empresa"      to wrk-IFI01-RESPONSABILIDADE
              when 3
                 move "Proprietário" to wrk-IFI01-RESPONSABILIDADE
           end-evaluate  

           perform Atualiza-Pg-2

           exit paragraph
           .
      *
       t1-Gd-1-Ev-Msg-Goto-Cell-Mouse.
           perform t1-Gd-1-Ev-Msg-Goto-Cell
           .
      *
       t1-Gd-3-Ev-Msg-Begin-Entry.
           Set Event-Action to Event-Action-Fail
           .
      *
       t1-Gd-3-Ev-Msg-Goto-Cell.
           modify t1-Gd-3, Start-X 1
                                 X 6
                           Start-Y event-data-2
                                 Y event-data-2
                           Region-Color 80

           move zeros to wrk-progressivo-gd-3

           inquire t1-Gd-3 (event-data-2, 1) hidden-data 
                                                 in wrk-progressivo-gd-3 

           initialize REG-T01-C074-3
           move wrk-codigo-ifc       to T01-C074-3-CODIGO
           move wrk-progressivo-gd-3 to T01-C074-3-PROGRESSIVO
           read T01-C074-3 with no lock
           if not valid-T01-C074-3
              initialize REG-T01-C074-3
           end-if                      
           move T01-C074-3-DATA    to IFM01-DATLANCAMENTO
           move T01-C074-3-TIPO    to IFM01-TIPO
           move T01-C074-3-CAMINHO to IFM01-CAMINHO

           display t1-Ef-IFM01-DATLANCAMENTO
           perform Atualiza-Pg-4
           .
      *
       t1-Gd-3-Ev-Msg-Goto-Cell-Mouse.
           perform t1-Gd-3-Ev-Msg-Goto-Cell
           .
      *
       t1-Gd-4-Ev-Msg-Begin-Entry.
           Set Event-Action to Event-Action-Fail
           .
      *
       t1-Gd-4-Ev-Msg-Goto-Cell.
           modify t1-Gd-4, Start-X 1
                                 X 6
                           Start-Y event-data-2
                                 Y event-data-2
                           Region-Color 80
           .
      *
       t1-Gd-4-Ev-Msg-Goto-Cell-Mouse.
           perform t1-Gd-4-Ev-Msg-Goto-Cell
           .

       Atualiza-Pg-2.
           modify t1-Ef-IFC01-HORINFLACAO  value IFC01-HORINFLACAO
           modify t1-Ef-IFI01-NOTIFICACAO  value IFC01-NRONOTIFICACAO
           modify t1-Ef-IFC01-LOCINFLACAO  value IFC01-LOCINFLACAO
           modify t1-Ef-IFC01-MUNINFLACAO  value IFC01-MUNINFLACAO
           modify t1-Ef-wrk-IFC01-MUNINFLACAO 
                                           value wrk-IFC01-MUNINFLACAO
           modify t1-Ef-IFC01-AGEINFLACAO  value IFC01-AGEINFLACAO
           modify t1-Ef-IFC01-ORG-AUTUADOR value IFC01-ORG-AUTUADOR
           modify t1-Ef-IFI01-CODINFLACAO  value IFI01-CODINFLACAO
           modify t1-Ef-wrk-IFI01-CODINFLACAO 
                                           value wrk-IFI01-CODINFLACAO
           modify t1-Ef-IFI01-RESPONSABILIDADE 
                                           value IFI01-RESPONSABILIDADE
           modify t1-Ef-wrk-IFI01-RESPONSABILIDADE 
                                        value wrk-IFI01-RESPONSABILIDADE
           modify t1-Ef-wrk-artigo         value IFI01-ARTIGO
           modify t1-Ef-IFI01-PONTOS       value IFI01-PONTOS
           modify t1-Ef-IFI01-VALOR        value IFI01-VALOR
           modify t1-Ef-IFI01-IFI01-MEDREALIZADA 
                                           value IFI01-MEDREALIZADA
           .

       Atualiza-Pg-4.
           modify t1-Ef-IFM01-TIPO          value IFM01-TIPO
           modify t1-Ef-IFM01-CAMINHO       value IFM01-CAMINHO
           .

      *
       t1-Ef-IFC01-CODIGO-Aft-Procedure.
           if IFC01-CODIGO > 0
              move "A" to wrk-acaexe
              read ARQ-IFC01 with no lock
              if not valid-ARQ-IFC01
                 move "Código Inválido." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-CODIGO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              move IFC01-AUTINFLACAO to wrk-IFC01-AUTINFLACAO
              move IFC01-CODIGO      to wrk-IFC01-CODIGO
                                        wrk-codigo-ifc

              |exibe na tela
              move zeros to wrk-assinada
              if IFC01-ASSINADA = "S"
                 move 1 to wrk-assinada
              else
                 move 2 to wrk-assinada
              end-if
      
              move t1-Cm-1-Container(wrk-assinada) to t1-Cm-1-Value
              modify t1-Fr-3a-Cm-1 VALUE t1-Cm-1-Value

              |Protocolo 54.601
              if IFC01-TIPO is numeric
                 move zeros to wrk-tipo-combobox
                 if IFC01-TIPO = 1
                    move 1 to wrk-tipo-combobox
                 else
                    move 2 to wrk-tipo-combobox
                 end-if
              end-if
      
              move t1-Cm-2-Container(wrk-tipo-combobox) to t1-Cm-2-Value
              modify t1-Cm-1-Tipo VALUE t1-Cm-2-Value

              if IFC01-AUTINFLACAO-ANT not = spaces
                 initialize REG-IFC01x
                 move REG-IFC01 to REG-IFC01x
   
                 initialize REG-IFC01
                 move IFC01-AUTINFLACAO-ANTx to IFC01-AUTINFLACAO
                 start ARQ-IFC01 key is >= CHAVE-IFC01-AUTINFLACAO
                 read ARQ-IFC01 next with no lock
                 if valid-ARQ-IFC01 and 
                              IFC01-AUTINFLACAO-ANTx = IFC01-AUTINFLACAO
                    move IFC01-CODIGO to wrk-cod-ant
                    modify t1-Ef-wrk-cod-ant value wrk-cod-ant
                 end-if 
   
                 initialize REG-IFC01
                 move REG-IFC01x to REG-IFC01
              end-if
              |Fim

              initialize REG-VEI01
              move IFC01-VEICULO to VEI01-CODIGO
              read ARQ-VEI01 with no lock
              if not valid-ARQ-VEI01
                 initialize REG-VEI01
              end-if
  
              initialize REG-TIP01
              move VEI01-TIPO to TIP01-CODIGO
              read ARQ-TIP01 with no lock
              if not valid-ARQ-TIP01
                 initialize REG-TIP01
              end-if
              move VEI01-TIPO to wrk-marca-cod
              move TIP01-NOME to wrk-marca-nome

              initialize reg-mot01
              move IFC01-CONDUTOR to mot01-CODIGO
              read ARQ-MOT01 with no lock
              if not valid-ARQ-MOT01
                 initialize reg-mot01
              end-if
              move mot01-NOME to wrk-IFC01-CONDUTOR
              move mot01-CPF  to wrk-cpf
              move mot01-RG   to wrk-rg

              initialize REG-PRO01
              move IFC01-PROPRIETARIO to Pro01-CODIGO
              read ARQ-PRO01 with no lock
              if not valid-ARQ-PRO01
                 initialize REG-PRO01
              end-if
              move Pro01-NOME to wrk-IFC01-PROPRIETARIO

              initialize REG-CID01
              move VEI01-ESTADO to CID01-ESTADO
              move VEI01-MUNICI to CID01-CIDADE
              start arq-cid01 key is >= CHAVE-CID01-ESTADO
              read arq-cid01 next with no lock
              if not valid-arq-cid01 or VEI01-ESTADO not = CID01-ESTADO
                                     or VEI01-MUNICI not = CID01-CIDADE
                 initialize REG-CID01
              end-if
              move CID01-CODIGO to wrk-munic-cod
              move CID01-CIDADE to wrk-munic-nome
              move CID01-ESTADO to wrk-uf-pg1

              initialize REG-CID01
              move IFC01-MUNINFLACAO to CID01-CODIGO
              read arq-cid01 with no lock
              if not valid-arq-cid01
                 initialize REG-CID01
              end-if
              move CID01-CIDADE to wrk-IFC01-MUNINFLACAO

              initialize REG-FOR15
              move IFC01-ORG-AUTUADOR to FOR15-CODIGO
              read ARQ-FOR15 with no lock
              if not valid-ARQ-FOR15
                 initialize REG-FOR15
              end-if
              move FOR15-NOME to wrk-IFC01-ORG-AUTUADOR

              move zeros to wrk-contagem-gd1
                            wrk-contagem-gd2
                            wrk-contagem-gd3
                            wrk-contagem-gd4
                            wrk-contagem-gd5

              perform Limpa-Grid-Pg2

              initialize REG-IFI01
              move IFC01-CODIGO to IFI01-CODIGO
              move low-value    to IFI01-CODINFLACAO 
              start ARQ-IFI01 key is >= IFI01-CHAVE
              read ARQ-IFI01 next with no lock
              if valid-ARQ-IFI01 and IFC01-CODIGO = IFI01-CODIGO 
                 perform until IFC01-CODIGO not = IFI01-CODIGO or 
                                                     not valid-ARQ-IFI01
                    add 1 to wrk-contagem-gd1
   
                    if wrk-contagem-gd1 = 1
                       perform criar-temp-5
                       if wrk-ok = "N"
                          exit paragraph
                       end-if
                    end-if
         
                    initialize REG-T01-C074-5
                    move wrk-codigo-ifc    to T01-C074-5-CODIGO-IFC
                    move wrk-contagem-gd1  to T01-C074-5-PROGRESSIVO
                    move IFI01-CODINFLACAO to T01-C074-5-CODIGO

                    initialize REG-IFC99
                    move IFI01-CODINFLACAO to IFC99-CODIGO
                    read ARQ-IFC99 with no lock
                    if not valid-ARQ-IFC99
                       initialize REG-IFC99
                    end-if

                    move IFC99-DESCRICAO   to T01-C074-5-DESCRICAO
                    move IFI01-PONTOS      to T01-C074-5-PONTUACAO
                    move IFI01-VALOR       to T01-C074-5-VALOR
                    move IFI01-RESPONSABILIDADE 
                                          to T01-C074-5-RESPONSABILIDADE
                    move IFI01-ARTIGO     to T01-C074-5-ARTIGO
                    move IFI01-MEDREALIZADA 
                                          to T01-C074-5-MEDREALIZADA

                    add IFI01-VALOR to wrk-total-infracao
         
                    write REG-T01-C074-5
                    if not Valid-T01-C074-5
                       move "Não foi possivel gravar o arquivo"  
                                                        to wrk-message-1
                       string "temporario. Status: " Stat-T01-C074-5
                                                      into wrk-message-2
                       move "N" to wrk-ok
                       perform mensagem
                    end-if
   
                    read ARQ-IFI01 next with no lock
                 end-perform
                 perform Preenche-Gd-1
              end-if
              
              perform Limpa-Grid-Pg4

              initialize REG-IFM01
              move IFC01-CODIGO to IFM01-CODIGO
              move low-value    to IFM01-PROGRESSIVO
              start ARQ-IFM01 key is >= IFM01-CHAVE
              read ARQ-IFM01 next with no lock
              if valid-ARQ-IFM01 and IFC01-CODIGO = IFM01-CODIGO
                 perform until not valid-ARQ-IFM01 or 
                                      IFC01-CODIGO not = IFM01-CODIGO

                    add 1 to wrk-contagem-gd3
   
                    if wrk-contagem-gd3 = 1
                       perform criar-temp-3
                       if wrk-ok = "N"
                          exit paragraph
                       end-if
                    end-if
         
                    initialize REG-T01-C074-3
                    move wrk-codigo-ifc      to T01-C074-3-CODIGO
                    move wrk-contagem-gd3    to T01-C074-3-PROGRESSIVO
                    move IFM01-DATLANCAMENTO to T01-C074-3-DATA
                    move IFM01-TIPO          to T01-C074-3-TIPO
                    move IFM01-CAMINHO       to T01-C074-3-CAMINHO
                    move IFM01-PROGRESSIVO   to T01-C074-3-PROGRE-IFM
         
                    write REG-T01-C074-3
                    if not Valid-T01-C074-3
                       move "Não foi possivel gravar o arquivo" 
                                                        to wrk-message-1
                       string "temporario. Status: " Stat-T01-C074-3
                                                      into wrk-message-2
                       move "N" to wrk-ok
                       perform mensagem
                    end-if
                    
                    move zeros to wrk-progressivo-gd-3
   
                    read ARQ-IFM01 next with no lock
                 end-perform  
                 perform Preenche-Gd-3
              end-if
              
              |Protocolo 54.609
              perform Limpa-Grid-Pg5
              move zeros to wrk-data-ifs

              initialize REG-IFS01
              move IFC01-CODIGO to IFS01-CODIGO
              move low-value    to IFS01-PROGRESSIVO
              start ARQ-IFS01 key is >= IFS01-CHAVE
              read ARQ-IFS01 next with no lock
              if valid-ARQ-IFS01 and IFC01-CODIGO = IFS01-CODIGO
                 perform until not valid-ARQ-IFS01 or 
                                         IFC01-CODIGO not = IFS01-CODIGO
                    add 1 to wrk-contagem-gd4
      
                    if wrk-contagem-gd4 = 1
                       perform criar-temp-4
                       if wrk-ok = "N"
                          exit paragraph
                       end-if
                    end-if
         
                    initialize REG-T01-C074-4
                    move wrk-codigo-ifc    to T01-C074-4-CODIGO
                    move wrk-contagem-gd4  to T01-C074-4-PROGRESSIVO
                    move IFS01-DATSITUACAO to T01-C074-4-DATA
                    move IFS01-HORSITUACAO to T01-C074-4-HORA
                    move IFS01-TIPO        to T01-C074-4-TIPO
                    move IFS01-OBSERVACAO1 to T01-C074-4-OBS1
                    move IFS01-OBSERVACAO2 to T01-C074-4-OBS2
                    move IFS01-OBSERVACAO3 to T01-C074-4-OBS3
                    move IFS01-OBSERVACAO4 to T01-C074-4-OBS4
                    move IFS01-OBSERVACAO5 to T01-C074-4-OBS5
                    move IFS01-PROGRESSIVO to T01-C074-4-PROGRE-IFS
                    |Protocolo 54.639
                    move IFS01-OPERADOR    to T01-C074-4-OPERADOR
                    |Fim
         
                    write REG-T01-C074-4
                    if not Valid-T01-C074-4
                       move "Não foi possivel gravar o arquivo"  
                                                        to wrk-message-1
                       string "temporario. Status: " Stat-T01-C074-4
                                                      into wrk-message-2
                       move "N" to wrk-ok
                       perform mensagem
                    end-if
         
                    move IFS01-DATSITUACAO to wrk-data-ifs
      
                    move zeros to wrk-progressivo-gd-4
      
                    read ARQ-IFS01 next with no lock
                 end-perform 
                 perform Preenche-IFC01-CODIGO
                 perform Preenche-Gd-4
      
                 move wrk-data-ifs to IFS01-DATSITUACAO
              end-if

              |Protocolo 54.639
              move zeros      to wrk-tipo-multa-ant
              move IFC01-TIPO to wrk-tipo-multa-ant

              initialize REG-IFS01
              move IFC01-CODIGO to IFS01-CODIGO
              move high-value   to IFS01-PROGRESSIVO
              start ARQ-IFS01 key is < IFS01-CHAVE
              read ARQ-IFS01 previous with no lock

              perform until not valid-ARQ-IFS01 or 
                                         IFC01-CODIGO not = IFS01-CODIGO
                 if IFS01-OBSERVACAO1 not = 
                                     'Multa transformada em Notificação'
                                 and 'Notificação transformada em Multa'
                    exit perform
                 end-if

                 read ARQ-IFS01 previous with no lock
              end-perform
              |Fim
              
              evaluate IFS01-TIPO
                 when 1
                    move 'Lançada'    to wrk-IFS01-TIPO
                    modify t1-Ef-IFS01-OBSERVACAO1 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO2 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO3 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO4 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO5 enabled true
                 when 2
                    move 'Em Recurso' to wrk-IFS01-TIPO
                 when 3
                    move 'Cancelada'  to wrk-IFS01-TIPO
                 when 4 
                    move 'Aguardando' to wrk-IFS01-TIPO
                    modify t1-Ef-IFS01-OBSERVACAO1 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO2 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO3 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO4 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO5 enabled true
                 when 5
                    move 'Baixada'    to wrk-IFS01-TIPO
              end-evaluate

              move wrk-contagem-gd1 to wrk-nro-itens-gd-1
              move wrk-contagem-gd2 to wrk-nro-itens-gd-2
              move wrk-contagem-gd3 to wrk-nro-itens-gd-3
              move wrk-contagem-gd4 to wrk-nro-itens-gd-4

              move IFS01-OBSERVACAO1 to wrk-obs1
              move IFS01-OBSERVACAO2 to wrk-obs2
              move IFS01-OBSERVACAO3 to wrk-obs3
              move IFS01-OBSERVACAO4 to wrk-obs4
              move IFS01-OBSERVACAO5 to wrk-obs5
              |Fim Protocolo 54.609

              |********alteração de grid**********
              |G1
              initialize REG-IFI01x
              move REG-IFI01 to REG-IFI01x
              |********fim**********

              move zeros  to IFI01-RESPONSABILIDADE
                             IFI01-CODINFLACAO
                             IFI01-PONTOS
                             IFI01-VALOR
                             IFI01-MEDREALIZADA
      
              move spaces to wrk-IFI01-RESPONSABILIDADE
                             IFI01-ARTIGO
                             IFM01-TIPO
                             IFM01-CAMINHO

              if IFC01-ORG-AUTUADOR = zeros or = spaces
                 move IFC01-ORGINFLACAO to wrk-IFC01-ORG-AUTUADOR
              end-if

              display t1

              inquire t1-Pb-grava id in control-id
              move 4 to accept-control
              exit paragraph
           else
              move "I" to wrk-acaexe               

              inquire t1-Ef-IFC01-AUTINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t1-Ef-IFC01-VEICULO-Aft-Procedure.
           if IFC01-VEICULO not = spaces
              initialize REG-VEI01
              move IFC01-VEICULO to VEI01-CODIGO
              read ARQ-VEI01 with no lock
              if not valid-ARQ-VEI01
                 move "Veículo Inválido." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-VEICULO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              initialize REG-TIP01
              move VEI01-TIPO to TIP01-CODIGO
              read ARQ-TIP01 with no lock
              if not valid-ARQ-TIP01
                 initialize REG-TIP01
              end-if
              move VEI01-TIPO    to wrk-marca-cod
              move TIP01-NOME    to wrk-marca-nome
              move VEI01-CODPRO  to IFC01-PROPRIETARIO
              move VEI01-COD-MOT to IFC01-CONDUTOR

              initialize reg-mot01
              move IFC01-CONDUTOR to mot01-CODIGO
              read ARQ-MOT01 with no lock
              if not valid-ARQ-MOT01
                 initialize reg-mot01
              end-if
              move mot01-NOME to wrk-IFC01-CONDUTOR
              move mot01-NOME to wrk-IFC01-CONDUTOR
              move mot01-CPF  to wrk-cpf
              move mot01-RG   to wrk-rg

              initialize REG-PRO01
              move VEI01-CODPRO to Pro01-CODIGO
              read ARQ-PRO01 with no lock
              if not valid-ARQ-PRO01
                 initialize REG-PRO01
              end-if
              move Pro01-NOME to wrk-IFC01-PROPRIETARIO

              initialize REG-CID01
              move VEI01-ESTADO to CID01-ESTADO
              move VEI01-MUNICI to CID01-CIDADE
              start arq-cid01 key is >= CHAVE-CID01-ESTADO
              read arq-cid01 next with no lock
              if not valid-arq-cid01 or VEI01-ESTADO not = CID01-ESTADO
                                     or VEI01-MUNICI not = CID01-CIDADE
                 initialize REG-CID01
              end-if
              move CID01-CODIGO to wrk-munic-cod
              move CID01-CIDADE to wrk-munic-nome
              move CID01-ESTADO to wrk-uf-pg1

              display t1
           else
              move "Indique um Veículo." to wrk-message-1
              perform mensagem

              move spaces to wrk-marca-nome
                             wrk-IFC01-PROPRIETARIO
                             wrk-munic-nome
                             wrk-uf-pg1

              move zeros  to wrk-marca-cod
                             IFC01-PROPRIETARIO
                             wrk-munic-cod

              display t1

              inquire t1-Ef-IFC01-VEICULO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t1-Ef-IFC01-CONDUTOR-Aft-Procedure.
           if IFC01-CONDUTOR > 0
              initialize reg-mot01
              move IFC01-CONDUTOR to mot01-CODIGO
              read ARQ-MOT01 with no lock
              if not valid-ARQ-MOT01
                 move "Motorista Inválido." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-CONDUTOR id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
              move mot01-NOME to wrk-IFC01-CONDUTOR
              move mot01-CPF  to wrk-cpf
              move mot01-RG   to wrk-rg
           else
              move zeros  to wrk-cpf
              move spaces to wrk-rg
                             wrk-IFC01-CONDUTOR
           end-if
           .
      *
       t2-Aft-Initdata.
           move spaces to wrk-consCid
           move 1 to Wrk-Rbcid
           display t2
           .
      *
       t2-Pb-ok-Link.
           If Wrk-Rbcid = 2
             if Wrk-consCid = spaces
                initialize wrk-texto-msg
                move "Informar a cidade!" to wrk-message-1
                perform Mensagem
                inquire t2-Ef-Wrk-consCid, id in control-id
                move 4 to accept-control
                exit paragraph
             end-if
           end-if
           perform Acu-t2-Exit
           .
      *
       t2-Ef-wrk-consCid-Aft-Procedure.
           if Wrk-consCid = spaces
             initialize wrk-texto-msg
             move "Informar a cidade!" to wrk-message-1
             perform Mensagem
             inquire t2-Ef-Wrk-consCid, id in control-id
             move 4 to accept-control
             exit paragraph
           end-if
           .
      *
       t2-Rb-2-Link.
           move 2 to Wrk-Rbcid
           .
      *
       t2-Rb-2-Aft-Procedure.
           if Wrk-Rbcid = 2
              modify t2-Ef-Wrk-consCid, ENABLED 1
           else 
              modify t2-Ef-Wrk-consCid, ENABLED 0
           end-if
           .
      *
       t2-Rb-1-Link.
           move 1 to Wrk-Rbcid
           .
      *
       t1-Ef-IFC01-AUTINFLACAO-Aft-Procedure.
           if IFC01-AUTINFLACAO not = spaces
              if wrk-IFC01-AUTINFLACAO not = IFC01-AUTINFLACAO
                 if wrk-pergunta-btn not  = "S"
                    initialize REG-IFC01x
                    move REG-IFC01 to REG-IFC01x
      
                    initialize REG-IFC01
                    move IFC01-AUTINFLACAOx to IFC01-AUTINFLACAO
                    start ARQ-IFC01 key is >= CHAVE-IFC01-AUTINFLACAO
                    read ARQ-IFC01 next with no lock
                    if valid-ARQ-IFC01                        and 
                       IFC01-AUTINFLACAOx = IFC01-AUTINFLACAO and 
                       IFC01-CODIGOx not  = IFC01-CODIGO
                       |Protocolo 54.601
                       perform acu-t5-routine

                       if wrk-resposta = 'C'
                          inquire t1-Ef-IFC01-VEICULO id in control-id
                          move 4 to accept-control
                          exit paragraph
                       end-if

                       if wrk-resposta = 'A'
                          move IFC01-CODIGO to LNK-IFC01-CODIGO
                          perform inicio
                          inquire t1-Ef-IFC01-CODIGO id in control-id
                          move 4 to accept-control
                          exit paragraph
                       end-if
      
                       if wrk-resposta = 'S'
                          move REG-IFC01x to REG-IFC01
                          inquire t1-Ef-IFC01-AUTINFLACAO
                                                        id in control-id
                          move 4 to accept-control
                          exit paragraph
                       end-if
                       |Fim Protocolo 54.601
                       move REG-IFC01x to REG-IFC01
                    end-if
                    initialize REG-IFC01
                    move REG-IFC01x to REG-IFC01
                 end-if
              end-if
           else
              move "Indique um Auto de Infração." to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-AUTINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t1-Ta-1-Aft-Tabchg-Display.
           initialize REG-T01-C074-4
           start T01-C074-4 key is >= T01-C074-4-CHAVE
           read T01-C074-4 next with no lock
           if not valid-T01-C074-4
              perform Grava-T01-C074-4
              if wrk-ok = 'N'
                 exit paragraph
              end-if
           end-if

           if t1-Pg-2-Visible = 1 or 2 |Dados da Infração
              if wrk-acaexe = "I"
                 move wrk-data-inv-r-dia  to IFC01-DATINFLACAO-R-DIA      
                 move wrk-data-inv-r-mes  to IFC01-DATINFLACAO-R-MES      
                 move wrk-data-inv-r-ano  to IFC01-DATINFLACAO-R-ANO
                 move wrk-hora-lancamento to IFC01-HORINFLACAO

                 move zeros to wrk-assinada
                 if IFC01-ASSINADA = "S"
                    move 1 to wrk-assinada
                 else
                    move 2 to wrk-assinada
                 end-if
      
                 move t1-Cm-1-Container(wrk-assinada) to t1-Cm-1-Value
                 modify t1-Fr-3a-Cm-1 VALUE t1-Cm-1-Value 
   
                 display t1
                 perform Limpa-Grid-Pg2
              else
                 move zeros to wrk-assinada
                 if IFC01-ASSINADA = "S"
                    move 1 to wrk-assinada
                 else
                    move 2 to wrk-assinada
                 end-if
         
                 move t1-Cm-1-Container(wrk-assinada) to t1-Cm-1-Value
                 modify t1-Fr-3a-Cm-1 VALUE t1-Cm-1-Value
              end-if
   
              perform Limpa-Grid-Pg2

              perform Preenche-Gd-1             
           end-if              

           if t1-Pg-4-Visible = 1 or 3 |Imagens
              move wrk-data-inv-r-dia  to IFM01-DATLANCAMENTO-R-DIA
              move wrk-data-inv-r-mes  to IFM01-DATLANCAMENTO-R-MES
              move wrk-data-inv-r-ano  to IFM01-DATLANCAMENTO-R-ANO
              
              display t1
   
              perform Limpa-Grid-Pg4

              perform Preenche-Gd-3 
           end-if

           if t1-Pg-1-Visible = 1
              inquire t1-Ef-IFC01-AUTINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           if t1-Pg-2-Visible = 1
              inquire t1-Ef-IFC01-DATINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           if t1-Pg-4-Visible = 1
              inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t1-Ef-IFC01-DATINFLACAO-Aft-Procedure.
           if IFC01-DATINFLACAO = zeros
              move "Indique uma Data." to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-DATINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           else
              if IFC01-HORINFLACAO not > 0
                 move wrk-hora-lancamento to IFC01-HORINFLACAO
                 modify t1-Ef-IFC01-HORINFLACAO value IFC01-HORINFLACAO
              end-if
              
              move "@" to wrk-valid-data
              call "Rot-data" using IFC01-DATINFLACAO, wrk-valid-data
              cancel "Rot-data"
              if wrk-valid-data = "N"
                 move "Data Inválida." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-DATINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if
           .
      *
       t1-Ef-IFC01-MUNINFLACAO-Aft-Procedure.
           if IFC01-MUNINFLACAO > 0 
              initialize REG-CID01
              move IFC01-MUNINFLACAO to CID01-CODIGO
              read arq-cid01 with no lock
              if not valid-arq-cid01
                 move "Município Inválido." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-MUNINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
              move CID01-CIDADE to wrk-IFC01-MUNINFLACAO
           else
              move spaces to wrk-IFC01-MUNINFLACAO
           end-if

           perform Atualiza-Pg-2
           .
      *
       t1-Ef-IFC01-HORINFLACAO-Aft-Procedure.
           if IFC01-HORINFLACAO < 0,00 or IFC01-HORINFLACAO > 23,59
              move "Hora inválida." to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFC01-HORINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-If
           .
      *
       t1-Ef-IFI01-CODINFLACAO-Aft-Procedure.
           if IFI01-CODINFLACAO > 0
              initialize REG-IFC99
              move IFI01-CODINFLACAO to IFC99-CODIGO
              read ARQ-IFC99 with no lock
              if not valid-ARQ-IFC99
                 move "Código Inválido." to wrk-message-1
                 perform mensagem
                 move spaces to wrk-IFI01-CODINFLACAO
                 modify t1-Ef-wrk-IFI01-CODINFLACAO 
                                             value wrk-IFI01-CODINFLACAO
                 inquire t1-Ef-IFI01-CODINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              move IFC99-DESCRICAO        to wrk-IFI01-CODINFLACAO
              move IFC99-PONTOS           to IFI01-PONTOS
              move IFC99-VALOR            to IFI01-VALOR
              move IFC99-RESPONSABILIDADE to IFI01-RESPONSABILIDADE
              move IFC99-ARTIGO           to IFI01-ARTIGO
      
              evaluate IFI01-RESPONSABILIDADE
                 when 1
                    move "Condutor"     to wrk-IFI01-RESPONSABILIDADE
                 when 2
                    move "Empresa"      to wrk-IFI01-RESPONSABILIDADE
                 when 3
                    move "Proprietário" to wrk-IFI01-RESPONSABILIDADE
              end-evaluate

              perform Atualiza-Pg-2
           else
              initialize t1-Ta-1-Value
                         t1-Pg-1-Visible
                         t1-Pg-2-Visible
                         t1-Pg-4-Visible
                         key-status

              move 3  to t1-Ta-1-Value
                         t1-Pg-4-Visible

              display t1
              perform t1-Ta-1-Aft-Tabchg-Display
           end-if
           .
      *
       t1-Ef-IFI01-RESPONSABILIDADE-Aft-Procedure.
           if IFI01-RESPONSABILIDADE > 0
              if IFI01-RESPONSABILIDADE > 3
                 move "Responsabilidade Inválida." to wrk-message-1
                 perform mensagem
                 move spaces to wrk-IFI01-RESPONSABILIDADE
                 perform Atualiza-Pg-2
                 inquire t1-Ef-IFI01-RESPONSABILIDADE id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
              evaluate IFI01-RESPONSABILIDADE
                 when 1
                    move "Condutor"     to wrk-IFI01-RESPONSABILIDADE
                 when 2
                    move "Empresa"      to wrk-IFI01-RESPONSABILIDADE
                 when 3
                    move "Proprietário" to wrk-IFI01-RESPONSABILIDADE
              end-evaluate

              perform Atualiza-Pg-2
           end-if
           .
      *
       t3-Aft-Initdata.
           move zeros to wrk-responsavel
           display t3
           .
      *
       t3-Pb-Ok-Link.
           move "S" to wrk-resp-vai
           perform acu-t3-exit
           .
      
      *
       t1-Ef-IFM01-DATLANCAMENTO-Aft-Procedure.
           if IFM01-DATLANCAMENTO = zeros
              inquire t1-Pb-grava id in control-id
              move 4 to accept-control
              exit paragraph
           else
              move "@" to wrk-valid-data
              call "Rot-data" using IFM01-DATLANCAMENTO, wrk-valid-data
              cancel "Rot-data"
              if wrk-valid-data = "N"
                 move "Data Inválida." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if           
           .
      *
       t1-Pb-Inclui-Pg4-Link.
           if IFM01-DATLANCAMENTO = zeros or = spaces
              inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           if IFM01-CAMINHO = spaces
              inquire t1-Ef-IFM01-CAMINHO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           move 2 to wrk-leitura-grid
           move spaces to wrk-controle
           perform until wrk-leitura-grid > wrk-linha-grid-3
              move zeros  to wrk-progressivo-gd-3
   
              inquire t1-Gd-3 (wrk-leitura-grid, 1) hidden-data 
                                                 in wrk-progressivo-gd-3

              initialize REG-T01-C074-3
              move wrk-codigo-ifc       to T01-C074-3-CODIGO
              move wrk-progressivo-gd-3 to T01-C074-3-PROGRESSIVO
              read T01-C074-3 with no lock
              if valid-T01-C074-3 and 
                             (IFM01-DATLANCAMENTO = T01-C074-3-DATA  and
                              IFM01-TIPO          = T01-C074-3-TIPO  and
                              IFM01-CAMINHO       = T01-C074-3-CAMINHO) 
                 move "Registro já adicionado." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              add 1 to wrk-leitura-grid
           end-perform     

           |********alteração de grid**********
           initialize REG-T01-C074-3
           move wrk-codigo-ifc to T01-C074-3-CODIGO
           move low-value      to T01-C074-3-PROGRESSIVO
           start T01-C074-3 key is >= T01-C074-3-CHAVE
           read T01-C074-3 next with no lock
           if not valid-T01-C074-3
              initialize REG-T01-C074-3
           end-if
      
           perform until not valid-T01-C074-3
              if    IFM01-DATLANCAMENTO = T01-C074-3-DATA 
               and (IFM01-TIPO      not = T01-C074-3-TIPO
               and  IFM01-CAMINHO       = T01-C074-3-CAMINHO)
      
                 move IFM01-DATLANCAMENTO to T01-C074-3-DATA
                 move IFM01-TIPO          to T01-C074-3-TIPO
                 move IFM01-CAMINHO       to T01-C074-3-CAMINHO
      
                 rewrite REG-T01-C074-3
                 if not Valid-T01-C074-3
                    move "Não foi possivel regravar o arquivo"  
                                                        to wrk-message-1
                    string "temporario. Status: " Stat-T01-C074-3
                                                      into wrk-message-2
                    perform mensagem
                    exit paragraph
                 end-if
                 
                 initialize REG-IFM01

                 move zeros  to wrk-progressivo-gd-3
      
                 move wrk-data-inv-r-dia to IFM01-DATLANCAMENTO-R-DIA                                            
                 move wrk-data-inv-r-mes to IFM01-DATLANCAMENTO-R-MES                                          
                 move wrk-data-inv-r-ano to IFM01-DATLANCAMENTO-R-ANO
                                            
                 display t1-Ef-IFM01-DATLANCAMENTO
      
                 perform Limpa-Grid-Pg4
      
                 perform Preenche-Gd-3
      
                 perform Atualiza-Pg-4
                                             
                 inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
      
              read T01-C074-3 next with no lock
           end-perform 
           |********fim**********
           
           add 1 to wrk-contagem-gd3

           if wrk-contagem-gd3 = 1
              perform criar-temp-3
              if wrk-ok = "N"
                 exit paragraph
              end-if
           end-if

           initialize REG-T01-C074-3
           move wrk-codigo-ifc      to T01-C074-3-CODIGO
           move wrk-contagem-gd3    to T01-C074-3-PROGRESSIVO
           move IFM01-DATLANCAMENTO to T01-C074-3-DATA
           move IFM01-TIPO          to T01-C074-3-TIPO
           move IFM01-CAMINHO       to T01-C074-3-CAMINHO

           write REG-T01-C074-3
           if not Valid-T01-C074-3
              move "Não foi possivel gravar o arquivo"  to wrk-message-1
              string "temporario. Status: " Stat-T01-C074-3
                                                      into wrk-message-2
              move "N" to wrk-ok
              perform mensagem
           end-if

           string T01-C074-3-DATA-R-DIA "/"  
                  T01-C074-3-DATA-R-MES "/"
                  T01-C074-3-DATA-R-ANO 
                  into Gd-3-Data

           move T01-C074-3-TIPO to Gd-3-Tipo

           add 1 to wrk-linha-grid-3

           modify t1-Gd-3, NUM-ROWS wrk-linha-grid-3
                         RECORD-TO-ADD t1-Gd-3-Record

           modify t1-Gd-3 x=1 y= wrk-linha-grid-3
           hidden-data T01-C074-3-PROGRESSIVO

           move zeros to wrk-progressivo-gd-3

           initialize REG-IFM01

           move wrk-data-inv-r-dia to IFM01-DATLANCAMENTO-R-DIA
           move wrk-data-inv-r-mes to IFM01-DATLANCAMENTO-R-MES
           move wrk-data-inv-r-ano to IFM01-DATLANCAMENTO-R-ANO

           display t1-Ef-IFM01-DATLANCAMENTO

           perform Atualiza-Pg-4

           inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
           move 4 to accept-control
           exit paragraph
           .

       Criar-temp-3.
           move spaces to wrk-ok
           Close T01-C074-3
           Call 'C$DELETE' Using DRV-T01-C074-3, 'I'

           Close T01-C074-3
           move Spaces to DRV-T01-C074-3

           move zeros to wrk-hora-atual
           Accept wrk-hora-atual From Time

           String '\Comp-3\Temp\T01-C074-3-' 
                  ext-codusu '-' wrk-hora-atual(1:6) '.dad'
                  into DRV-T01-C074-3

           Open Output T01-C074-3
           Close       T01-C074-3
           Open I-O    T01-C074-3

           if NOT Valid-T01-C074-3
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              move 'Não foi possível criar o arquivo' to wrk-message-1
              string 'Temporário T01-C074-3. Status: ' Stat-T01-C074-3
              into wrk-message-2
              set wrk-warning-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
              move "N" to wrk-ok
              exit paragraph 
           End-if
           .
      *
       t1-Pb-Exclui-Pg4-Link.
           if wrk-progressivo-gd-3 = zeros
              move "Selecione um registro para continuar." 
                                                        to wrk-message-1
              perform mensagem
              exit paragraph
           end-if

           move 1 to wrk-prgantnovo
           move "Deseja excluir o registro selecionado?" 
                                                        to wrk-message-1
           set wrk-warning-type to true
           set wrk-yes-no-type  to true
           set wrk-default-2 to true
           Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                          wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem"
                                 
           if wrk-response = 1
              initialize REG-T01-C074-3
              move wrk-codigo-ifc       to T01-C074-3-CODIGO
              move wrk-progressivo-gd-3 to T01-C074-3-PROGRESSIVO
              read T01-C074-3 with no lock
              if not valid-T01-C074-3
                 move "Erro ao localizar o registro." to wrk-message-1
                 perform mensagem
                 exit paragraph
              end-if
              delete T01-C074-3
              if not valid-T01-C074-3
                 move "Erro na exclusão" to wrk-message-1
                 set wrk-error-type to true
                 set wrk-ok-type      to true
                 Call "mensagem" Using wrk-Message-Type, 
                                    wrk-Response-Type, 
                                    wrk-message-1,
                                    wrk-Message-2,
                                    wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"
                 exit paragraph
              end-if

              initialize REG-IFM01
              move IFC01-CODIGO to IFM01-CODIGO
              move low-value    to IFM01-PROGRESSIVO
              start ARQ-IFM01 key is >= IFM01-CHAVE
              read ARQ-IFM01 next with no lock
              if not valid-ARQ-IFM01 or IFC01-CODIGO not = IFM01-CODIGO 
                 perform Limpa-Grid-Pg4

                 |só apaga do grid
                 initialize REG-T01-C074-3
                 move wrk-codigo-ifc to T01-C074-3-CODIGO
                 move low-value      to T01-C074-3-PROGRESSIVO
                 start T01-C074-3 key is >= T01-C074-3-CHAVE
                 read T01-C074-3 next with no lock

                 perform until not valid-T01-C074-3
                    string T01-C074-3-DATA-R-DIA "/"  
                           T01-C074-3-DATA-R-MES "/"
                           T01-C074-3-DATA-R-ANO 
                           into Gd-3-Data
         
                    move T01-C074-3-TIPO to Gd-3-Tipo
         
                    add 1 to wrk-linha-grid-3
         
                    modify t1-Gd-3, NUM-ROWS wrk-linha-grid-3 
                                  RECORD-TO-ADD t1-Gd-3-Record
         
                    modify t1-Gd-3 x=1 y= wrk-linha-grid-3 
                    hidden-data T01-C074-3-PROGRESSIVO

                    read T01-C074-3 next with no lock
                 end-perform

                 initialize REG-IFM01 
                 perform Atualiza-Pg-4
              else
                 move "N" to wrk-exclui
                 perform until not valid-ARQ-IFM01 or 
                                         IFC01-CODIGO not = IFM01-CODIGO
                    if T01-C074-3-DATA        = IFM01-DATLANCAMENTO  and
                       T01-C074-3-TIPO        = IFM01-TIPO           and
                       T01-C074-3-CAMINHO     = IFM01-CAMINHO
                       move "S" to wrk-exclui
                       exit perform
                    end-if

                    read ARQ-IFM01 next with no lock
                 end-perform

                 if wrk-exclui = "N"
                    exit paragraph
                 end-if

                 delete ARQ-IFM01
                 if not valid-ARQ-IFM01
                    move 1 to  wrk-prgantnovo
                    initialize wrk-texto-msg
                    move "Erro na exclusão." to wrk-message-1
                    set wrk-error-type to true
                    set wrk-ok-type      to true
                    Call "mensagem" Using wrk-Message-Type, 
                                       wrk-Response-Type, 
                                       wrk-message-1,
                                       wrk-Message-2,
                                       wrk-Message-3
                    on overflow perform call-error end-call
                    Cancel "mensagem"
                 else
                    initialize REG-IFM01
   
                    perform Atualiza-Pg-4

                    perform Limpa-Grid-Pg4

                    |preenche grid
                    initialize REG-T01-C074-3
                    move wrk-codigo-ifc to T01-C074-3-CODIGO
                    move low-value      to T01-C074-3-PROGRESSIVO
                    start T01-C074-3 key is >= T01-C074-3-CHAVE
                    read T01-C074-3 next with no lock

                    perform until not valid-T01-C074-3
                       string T01-C074-3-DATA-R-DIA "/"  
                              T01-C074-3-DATA-R-MES "/"
                              T01-C074-3-DATA-R-ANO 
                              into Gd-3-Data
            
                       move T01-C074-3-TIPO to Gd-3-Tipo
           
                       add 1 to wrk-linha-grid-3
            
                       modify t1-Gd-3, NUM-ROWS wrk-linha-grid-3 
                                     RECORD-TO-ADD t1-Gd-3-Record
            
                       modify t1-Gd-3 x=1 y= wrk-linha-grid-3 
                       hidden-data T01-C074-3-PROGRESSIVO

                       read T01-C074-3 next with no lock
                    end-perform
                 end-if
              end-if
              move zeros to wrk-progressivo-gd-3
 
              inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if  
           .
      *
       t1-Ef-IFS01-DATSITUACAO-Aft-Procedure.
           if IFS01-DATSITUACAO > 0
              move "@" to wrk-valid-data
              call "Rot-data" using IFS01-DATSITUACAO, wrk-valid-data
              cancel "Rot-data"

              if IFS01-HORSITUACAO not > 0
                 move wrk-hora-lancamento to IFS01-HORSITUACAO
                 modify t1-Ef-IFS01-HORSITUACAO value IFS01-HORSITUACAO
              end-if

              if wrk-valid-data = "N"
                 move "Data Inválida." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFS01-DATSITUACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           else
              move zeros to IFS01-HORSITUACAO
              modify t1-Ef-IFS01-HORSITUACAO value IFS01-HORSITUACAO
              inquire t1-Pb-grava id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t1-Ef-IFS01-HORSITUACAO-Aft-Procedure.
           if IFS01-HORSITUACAO < 0,00 or IFS01-HORSITUACAO > 23,59
              move "Hora inválida." to wrk-message-1
              perform mensagem
              inquire t1-Ef-IFS01-HORSITUACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-If
           .
      *
       t6-Aft-Initdata.
           move zeros to wrk-tipo-t6
           display t6
           .
      *
       t6-Pb-Ok-Link.
           move "S" to wrk-tip-vai

           perform acu-t6-exit
           .

       Criar-temp-4.
           Close T01-C074-4
           Call 'C$DELETE' Using DRV-T01-C074-4, 'I'

           Close T01-C074-4
           move Spaces to DRV-T01-C074-4

           move zeros to wrk-hora-atual
           Accept wrk-hora-atual From Time

           String '\Comp-3\Temp\T01-C074-4-' 
                  ext-codusu '-' wrk-hora-atual(1:6) '.dad'
                  into DRV-T01-C074-4

           Open Output T01-C074-4
           Close       T01-C074-4
           Open I-O    T01-C074-4

           if NOT Valid-T01-C074-4
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              move 'Não foi possível criar o arquivo' to wrk-message-1
              string 'Temporário T01-C074-4. Status: ' Stat-T01-C074-4
              into wrk-message-2
              set wrk-warning-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
              move "N" to wrk-ok
              exit paragraph 
           End-if
           .
           
      *
       t1-Pb-Inclui-Pg2-Link.
           if IFI01-CODINFLACAO > 0
              initialize REG-IFC99
              move IFI01-CODINFLACAO to IFC99-CODIGO
              read ARQ-IFC99 with no lock
              if not valid-ARQ-IFC99
                 move "Código Inválido." to wrk-message-1
                 perform mensagem
                 move spaces to wrk-IFI01-CODINFLACAO
                 modify t1-Ef-wrk-IFI01-CODINFLACAO 
                                             value wrk-IFI01-CODINFLACAO
                 inquire t1-Ef-IFI01-CODINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              move IFC99-DESCRICAO        to wrk-IFI01-CODINFLACAO
              move IFC99-PONTOS           to IFI01-PONTOS

              if IFI01-VALOR = zeros
                 move IFC99-VALOR         to IFI01-VALOR
              end-if

              if IFI01-RESPONSABILIDADE = zeros
                 move IFC99-RESPONSABILIDADE to IFI01-RESPONSABILIDADE
              end-if

              evaluate IFI01-RESPONSABILIDADE
                 when 1
                    move "Condutor"     to wrk-IFI01-RESPONSABILIDADE
                 when 2
                    move "Empresa"      to wrk-IFI01-RESPONSABILIDADE
                 when 3
                    move "Proprietário" to wrk-IFI01-RESPONSABILIDADE
              end-evaluate

              perform Atualiza-Pg-2
           end-if

           if IFI01-RESPONSABILIDADE = zeros
              inquire t1-Ef-IFI01-RESPONSABILIDADE id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           move 2 to wrk-leitura-grid
           move spaces to wrk-controle
           perform until wrk-leitura-grid > wrk-linha-grid-1
              move zeros  to wrk-progressivo-gd-1
   
              inquire t1-Gd-1 (wrk-leitura-grid, 1) hidden-data 
                                                 in wrk-progressivo-gd-1

              initialize REG-T01-C074-5
              move wrk-codigo-ifc       to T01-C074-5-CODIGO-IFC
              move wrk-progressivo-gd-1 to T01-C074-5-PROGRESSIVO
              read T01-C074-5 with no lock
              if valid-T01-C074-5                                   
                 and IFI01-CODINFLACAO     = T01-C074-5-CODIGO           
                 and IFI01-RESPONSABILIDADE 
                                           = T01-C074-5-RESPONSABILIDADE 
                 and IFI01-VALOR           = T01-C074-5-VALOR
                 and IFI01-MEDREALIZADA    = T01-C074-5-MEDREALIZADA
                 move "Registro já adicionado." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFI01-CODINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              add 1 to wrk-leitura-grid
           end-perform
  
           |********alteração de grid**********
           initialize REG-T01-C074-5
           move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
           move low-value     to T01-C074-5-PROGRESSIVO
           start T01-C074-5 key is >= T01-C074-5-CHAVE
           read T01-C074-5 next with no lock
           if not valid-T01-C074-5
              initialize REG-T01-C074-5
           end-if
      
           perform until not valid-T01-C074-5
              initialize REG-IFC99
              move IFI01-CODINFLACAO to IFC99-CODIGO
              read ARQ-IFC99 with no lock
              if not valid-ARQ-IFC99
                 initialize REG-IFC99
              end-if

              if IFI01-CODINFLACAO         = T01-C074-5-CODIGO and          
                (IFI01-RESPONSABILIDADE not 
                                           = T01-C074-5-RESPONSABILIDADE 
                 or IFI01-VALOR        not = T01-C074-5-VALOR
                 or IFI01-MEDREALIZADA not = T01-C074-5-MEDREALIZADA)

                 move IFI01-CODINFLACAO  to T01-C074-5-CODIGO
                 move IFC99-DESCRICAO    to T01-C074-5-DESCRICAO
                 move IFI01-PONTOS       to T01-C074-5-PONTUACAO
                 move IFI01-VALOR        to T01-C074-5-VALOR
                 move IFI01-RESPONSABILIDADE
                                         to T01-C074-5-RESPONSABILIDADE
                 move IFI01-ARTIGO       to T01-C074-5-ARTIGO
                 move IFI01-MEDREALIZADA to T01-C074-5-MEDREALIZADA

                 add IFI01-VALOR to wrk-total-infracao
      
                 rewrite REG-T01-C074-5
                 if not Valid-T01-C074-5
                    move "Não foi possivel regravar o arquivo"  
                                                        to wrk-message-1
                    string "temporario. Status: " Stat-T01-C074-5
                                                      into wrk-message-2
                    perform mensagem
                    exit paragraph
                 end-if
                 perform Limpa-Grid-Pg2
      
                 perform Preenche-Gd-1
      
                 initialize REG-IFI01
                  
                 move zeros  to wrk-progressivo-gd-1      
                 move spaces to wrk-IFI01-RESPONSABILIDADE
      
                 perform Atualiza-Pg-2
      
                 inquire t1-Ef-IFI01-CODINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
      
              read T01-C074-5 next with no lock
           end-perform 
           |********fim**********

           add 1 to wrk-contagem-gd1

           if wrk-contagem-gd1 = 1
              perform criar-temp-5
              if wrk-ok = "N"
                 exit paragraph
              end-if
           end-if

           initialize REG-T01-C074-5
                      REG-IFC99

           move IFI01-CODINFLACAO to IFC99-CODIGO
           read ARQ-IFC99 with no lock
           if not valid-ARQ-IFC99
              initialize REG-IFC99
           end-if
           move wrk-codigo-ifc         to T01-C074-5-CODIGO-IFC
           move wrk-contagem-gd1       to T01-C074-5-PROGRESSIVO
           move IFI01-CODINFLACAO      to T01-C074-5-CODIGO
           move IFC99-DESCRICAO        to T01-C074-5-DESCRICAO
           move IFI01-PONTOS           to T01-C074-5-PONTUACAO
           move IFI01-VALOR            to T01-C074-5-VALOR
           move IFI01-RESPONSABILIDADE to T01-C074-5-RESPONSABILIDADE
           move IFI01-ARTIGO           to T01-C074-5-ARTIGO
           move IFI01-MEDREALIZADA     to T01-C074-5-MEDREALIZADA

           add IFI01-VALOR to wrk-total-infracao

           write REG-T01-C074-5
           if not Valid-T01-C074-5
              move "Não foi possivel gravar o arquivo"  to wrk-message-1
              string "temporario. Status: " Stat-T01-C074-5
                                                      into wrk-message-2
              move "N" to wrk-ok
              perform mensagem
              exit paragraph
           end-if

           move T01-C074-5-CODIGO    to Gd-1-Codigo
           move T01-C074-5-DESCRICAO to Gd-1-Descricao
           move T01-C074-5-PONTUACAO to Gd-1-Pontuacao
           move T01-C074-5-VALOR     to Gd-1-Valor

           add 1 to wrk-linha-grid-1

           modify t1-Gd-1, NUM-ROWS wrk-linha-grid-1 
                         RECORD-TO-ADD t1-Gd-1-Record

           modify t1-Gd-1 x=1 y=wrk-linha-grid-1 
                  hidden-data T01-C074-5-PROGRESSIVO

           initialize REG-IFI01
                  
           move zeros  to wrk-progressivo-gd-1
           move spaces to wrk-IFI01-RESPONSABILIDADE
                          wrk-IFI01-CODINFLACAO

           perform Atualiza-Pg-2

           inquire t1-Ef-IFI01-CODINFLACAO id in control-id
           move 4 to accept-control
           exit paragraph
           .

       Criar-temp-5.
           move spaces to wrk-ok
           Close T01-C074-5
           Call 'C$DELETE' Using DRV-T01-C074-5, 'I'

           Close T01-C074-5
           move Spaces to DRV-T01-C074-5

           move zeros to wrk-hora-atual
           Accept wrk-hora-atual From Time

           String '\Comp-3\Temp\T01-C074-5-' 
                  ext-codusu '-' wrk-hora-atual(1:6) '.dad'
                  into DRV-T01-C074-5

           Open Output T01-C074-5
           Close       T01-C074-5
           Open I-O    T01-C074-5

           if NOT Valid-T01-C074-5
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              move 'Não foi possível criar o arquivo' to wrk-message-1
              string 'Temporário T01-C074-5. Status: ' Stat-T01-C074-5
              into wrk-message-2
              set wrk-warning-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
              move "N" to wrk-ok
              exit paragraph 
           End-if
           .
      *
       t1-Pb-grava-Link.
           |Verificações
           |Primeira Aba
           |Protocolo 54.601
           |Auto Infração
           if IFC01-AUTINFLACAO not = spaces
              if wrk-pergunta-btn not  = "S"
                 initialize REG-IFC01x
                 move REG-IFC01 to REG-IFC01x
   
                 initialize REG-IFC01
                 move IFC01-AUTINFLACAOx to IFC01-AUTINFLACAO
                 start ARQ-IFC01 key is >= CHAVE-IFC01-AUTINFLACAO
                 read ARQ-IFC01 next with no lock
                 if valid-ARQ-IFC01                        and 
                    IFC01-AUTINFLACAOx = IFC01-AUTINFLACAO and 
                    IFC01-CODIGOx not  = IFC01-CODIGO
                    perform acu-t5-routine 

                    if wrk-resposta = 'A'
                       move IFC01-CODIGO to LNK-IFC01-CODIGO
                       perform inicio
                       inquire t1-Ef-IFC01-CODIGO id in control-id
                       move 4 to accept-control
                       exit paragraph
                    end-if
   
                    if wrk-resposta = 'S'
                       move REG-IFC01x to REG-IFC01
                       inquire t1-Ef-IFC01-AUTINFLACAO
                                                     id in control-id
                       move 4 to accept-control
                       exit paragraph
                    end-if
                    move "S" to wrk-pergunta-btn
                    move REG-IFC01x to REG-IFC01
                 end-if
                 initialize REG-IFC01
                 move REG-IFC01x to REG-IFC01
              end-if
           else
              move "Indique um Auto de Infração." to wrk-message-1
              perform mensagem

              move 'S' to wrk-erro-btn-gravar

              initialize t1-Ta-1-Value
                         t1-Pg-1-Visible
                         t1-Pg-2-Visible
                         t1-Pg-4-Visible
              move 1  to t1-Ta-1-Value
                         t1-Pg-1-Visible

              display t1

              inquire t1-Ef-IFC01-AUTINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           |Fim Protocolo 54.601

           |Veículo
           if IFC01-VEICULO not = spaces
              initialize REG-VEI01
              move IFC01-VEICULO to VEI01-CODIGO
              read ARQ-VEI01 with no lock
              if not valid-ARQ-VEI01
                 move "Veículo Inválido." to wrk-message-1
                 perform mensagem

                 initialize t1-Ta-1-Value
                            t1-Pg-1-Visible
                            t1-Pg-2-Visible
                            t1-Pg-4-Visible
                 move 1  to t1-Ta-1-Value
                            t1-Pg-1-Visible

                 display t1

                 move 'S' to wrk-erro-btn-gravar

                 inquire t1-Ef-IFC01-VEICULO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              initialize REG-TIP01
              move VEI01-TIPO to TIP01-CODIGO
              read ARQ-TIP01 with no lock
              if not valid-ARQ-TIP01
                 initialize REG-TIP01
              end-if
              move VEI01-TIPO   to wrk-marca-cod
              move TIP01-NOME   to wrk-marca-nome
              move VEI01-CODPRO to IFC01-PROPRIETARIO

              initialize REG-PRO01
              move VEI01-CODPRO to Pro01-CODIGO
              read ARQ-PRO01 with no lock
              if not valid-ARQ-PRO01
                 initialize REG-PRO01
              end-if
              move Pro01-NOME to wrk-IFC01-PROPRIETARIO

              initialize REG-CID01
              move VEI01-ESTADO to CID01-ESTADO
              move VEI01-MUNICI to CID01-CIDADE
              start arq-cid01 key is >= CHAVE-CID01-ESTADO
              read arq-cid01 next with no lock
              if not valid-arq-cid01 or VEI01-ESTADO not = CID01-ESTADO
                                     or VEI01-MUNICI not = CID01-CIDADE
                 initialize REG-CID01
              end-if
              move CID01-CODIGO to wrk-munic-cod
              move CID01-CIDADE to wrk-munic-nome
              move CID01-ESTADO to wrk-uf-pg1

              display t1
           else
              move "Indique um Veículo." to wrk-message-1
              perform mensagem

              move spaces to wrk-marca-nome
                             wrk-IFC01-PROPRIETARIO
                             wrk-munic-nome
                             wrk-uf-pg1

              move zeros  to wrk-marca-cod
                             IFC01-PROPRIETARIO
                             wrk-munic-cod

              display t1

              move 'S' to wrk-erro-btn-gravar

              inquire t1-Ef-IFC01-VEICULO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           |Motorista
           if IFC01-CONDUTOR > 0
              initialize reg-mot01
              move IFC01-CONDUTOR to mot01-CODIGO
              read ARQ-MOT01 with no lock
              if not valid-ARQ-MOT01
                 move "Motorista Inválido." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-CONDUTOR id in control-id
                 move 4 to accept-control

                 move 'S' to wrk-erro-btn-gravar

                 exit paragraph
              end-if
              move mot01-NOME to wrk-IFC01-CONDUTOR
              move mot01-CPF  to wrk-cpf
              move mot01-RG   to wrk-rg
           else
              move zeros  to wrk-cpf
              move spaces to wrk-rg
                             wrk-IFC01-CONDUTOR
           end-if
           display t1

           |Protocolo 54.609
           |Situação
           if IFS01-OBSERVACAO1 not = wrk-obs1 or
              IFS01-OBSERVACAO2 not = wrk-obs2 or
              IFS01-OBSERVACAO3 not = wrk-obs3 or
              IFS01-OBSERVACAO4 not = wrk-obs4 or
              IFS01-OBSERVACAO5 not = wrk-obs5
              |Grava Temp
              perform Grava-T01-C074-4
              if wrk-ok = 'N'
                 exit paragraph
              end-if
           end-if

           |Fim Protocolo 54.609

           |Segunda Aba
           |Data da Infração
           if IFC01-DATINFLACAO = zeros
              move "Indique uma Data." to wrk-message-1
              perform mensagem 
             
              move 'S' to wrk-erro-btn-gravar

              inquire t1-Ef-IFC01-DATINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           else
              move "@" to wrk-valid-data
              call "Rot-data" using IFC01-DATINFLACAO, wrk-valid-data
              cancel "Rot-data"
              if wrk-valid-data = "N"

                 move 'S' to wrk-erro-btn-gravar

                 move "Data Inválida." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-DATINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if

           |Hora
           if IFC01-HORINFLACAO < 0,00 or IFC01-HORINFLACAO > 23,59
              move "Hora inválida." to wrk-message-1
              perform mensagem

              move 'S' to wrk-erro-btn-gravar

              inquire t1-Ef-IFC01-HORINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           |Município
           if IFC01-MUNINFLACAO > 0 
              initialize REG-CID01
              move IFC01-MUNINFLACAO to CID01-CODIGO
              read arq-cid01 with no lock
              if not valid-arq-cid01
                 move "Município Inválido." to wrk-message-1
                 perform mensagem

                 move 'S' to wrk-erro-btn-gravar

                 inquire t1-Ef-IFC01-MUNINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
              move CID01-CIDADE to wrk-IFC01-MUNINFLACAO
           else
              move spaces to wrk-IFC01-MUNINFLACAO
           end-if 
           perform Atualiza-Pg-2

           |Código
           if IFI01-CODINFLACAO > 0
              initialize REG-IFC99
              move IFI01-CODINFLACAO to IFC99-CODIGO
              read ARQ-IFC99 with no lock
              if not valid-ARQ-IFC99
                 move "Código Inválido." to wrk-message-1
                 perform mensagem

                 move 'S' to wrk-erro-btn-gravar

                 move spaces to wrk-IFI01-CODINFLACAO
                 modify t1-Ef-wrk-IFI01-CODINFLACAO 
                                             value wrk-IFI01-CODINFLACAO
                 inquire t1-Ef-IFI01-CODINFLACAO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if

              move IFC99-DESCRICAO        to wrk-IFI01-CODINFLACAO
              move IFC99-PONTOS           to IFI01-PONTOS

              if IFI01-VALOR = zeros
                 move IFC99-VALOR         to IFI01-VALOR
              end-if

              if IFI01-RESPONSABILIDADE = zeros
                 move IFC99-RESPONSABILIDADE to IFI01-RESPONSABILIDADE
              end-if

              evaluate IFI01-RESPONSABILIDADE
                 when 1
                    move "Condutor"     to wrk-IFI01-RESPONSABILIDADE
                 when 2
                    move "Empresa"      to wrk-IFI01-RESPONSABILIDADE
                 when 3
                    move "Proprietário" to wrk-IFI01-RESPONSABILIDADE
              end-evaluate

              perform Atualiza-Pg-2
           end-if

           |Responsabilidade
           if IFI01-RESPONSABILIDADE > 0
              if IFI01-RESPONSABILIDADE > 3
                 move "Responsabilidade Inválida." to wrk-message-1
                 perform mensagem

                 move 'S' to wrk-erro-btn-gravar

                 move spaces to wrk-IFI01-RESPONSABILIDADE
                 perform Atualiza-Pg-2
                 inquire t1-Ef-IFI01-RESPONSABILIDADE id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
              evaluate IFI01-RESPONSABILIDADE
                 when 1
                    move "Condutor"     to wrk-IFI01-RESPONSABILIDADE
                 when 2
                    move "Empresa"      to wrk-IFI01-RESPONSABILIDADE
                 when 3
                    move "Proprietário" to wrk-IFI01-RESPONSABILIDADE
              end-evaluate

              perform Atualiza-Pg-2
           end-if

           |Assinada
           if t1-cm-1-value = spaces
              move "Indique se a infração está assinada." 
                                                        to wrk-message-1
              move 'S' to wrk-erro-btn-gravar

              perform mensagem
              inquire t1-Fr-3a-Cm-1 id in control-id
              move 4 to accept-control

              initialize t1-Ta-1-Value
                         t1-Pg-1-Visible
                         t1-Pg-4-Visible
              move 2  to t1-Ta-1-Value
                         t1-Pg-2-Visible

              display t1

              perform Limpa-Grid-Pg2

              perform Preenche-Gd-1

              exit paragraph
           end-if

           |Quarta Aba
           |Data
           if IFM01-DATLANCAMENTO > 0
              move "@" to wrk-valid-data
              call "Rot-data" using IFM01-DATLANCAMENTO, wrk-valid-data
              cancel "Rot-data"
              if wrk-valid-data = "N"
                 move "Data Inválida." to wrk-message-1
                 perform mensagem

                 move 'S' to wrk-erro-btn-gravar

                 inquire t1-Ef-IFM01-DATLANCAMENTO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if

           |Gravação
           if wrk-acaexe = "I"
              |ARQ-IFC01
              perform Preenche-IFC01-CODIGO

              move IFC01-CODIGOz      to IFC01-CODIGO
              move usu-codigo         to IFC01-OPELANCAMENTO
              move t1-Cm-1-Value(1:1) to IFC01-ASSINADA
              |Protocolo 54.601
              move t1-Cm-2-Value(1:1) to IFC01-TIPO
              |Fim

              if IFC01-DAT-VENCIMENTO = spaces or 
                 IFC01-DAT-VENCIMENTO not numeric
                 move zeros to IFC01-DAT-VENCIMENTO
              end-if

              if IFC01-ASSINADA = spaces
                 move "N" to IFC01-ASSINADA
              end-if

              write REG-IFC01
              if not valid-ARQ-IFC01
                 move "Erro na gravação do arquivo ARQ-IFC01." 
                                                        to wrk-message-1
                 string "Status: " STAT-ARQ-IFC01 into wrk-message-2
                 perform mensagem

                 move 'S' to wrk-erro-btn-gravar

                 exit paragraph
                 |Fim ARQ-IFC01
              else
                 |ARQ-IFI01
                 if wrk-linha-grid-1 > 1
                    initialize REG-T01-C074-5
                    move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
                    move low-value      to T01-C074-5-PROGRESSIVO
                    start T01-C074-5 key is >= T01-C074-5-CHAVE
                    read T01-C074-5 next with no lock
                    if not valid-T01-C074-5
                       move "Não foi possível localizar o registro" 
                                                        to wrk-message-1
                       string "no arquivo T01-C074-5. Status: " 
                               STAT-T01-C074-5        into wrk-message-2
                       perform mensagem
                       perform Deleta-ARQ-IFC

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if
                       
                    perform until not valid-T01-C074-5
                       initialize REG-IFC99
                       move T01-C074-5-CODIGO to IFC99-CODIGO
                       read ARQ-IFC99 with no lock
                       if not valid-ARQ-IFC99
                          initialize REG-IFC99
                       end-if                 

                       move IFC01-CODIGO         to IFI01-CODIGO
                       move T01-C074-5-CODIGO    to IFI01-CODINFLACAO 
                       move IFC99-GRAU           to IFI01-GRAU
                       move IFC99-PONTOS         to IFI01-PONTOS
                       move T01-C074-5-VALOR     to IFI01-VALOR
                       move IFC99-VALCONSIDERADO to IFI01-VALCONSIDERADO
                       move IFC99-VALREGULAMENTADO 
                                               to IFI01-LIMREGULAMENTADO
                       move T01-C074-5-RESPONSABILIDADE 
                                               to IFI01-RESPONSABILIDADE
                       move IFC01-NRONOTIFICACAO to IFI01-NOTIFICACAO
                       move IFC99-ARTIGO         to IFI01-ARTIGO
                       move T01-C074-5-MEDREALIZADA 
                                                 to IFI01-MEDREALIZADA

                       write REG-IFI01
                       if not valid-ARQ-IFI01
                          move "Erro na gravação do arquivo ARQ-IFI01."
                                                        to wrk-message-1
                          string "Status: " STAT-ARQ-IFI01 
                                                      into wrk-message-2
                          perform mensagem
                          perform Deleta-ARQ-IFC

                          move 'S' to wrk-erro-btn-gravar

                          exit paragraph
                       end-if

                       read T01-C074-5 next with no lock
                    end-perform
                 end-if
                 |Fim ARQ-IFI01

                 |ARQ-IFM01
                 initialize REG-IFM01x
                 move REG-IFM01 to REG-IFM01x

                 if wrk-linha-grid-3 > 1
                    initialize REG-T01-C074-3
                    move wrk-codigo-ifc to T01-C074-3-CODIGO
                    move low-value      to T01-C074-3-PROGRESSIVO
                    start T01-C074-3 key is >= T01-C074-3-CHAVE
                    read T01-C074-3 next with no lock
                    if not valid-T01-C074-3
                       move "Não foi possível localizar o registro" 
                                                        to wrk-message-1
                       string "no T01-C074-3. Status: " STAT-T01-C074-3 
                                                      into wrk-message-2
                       perform mensagem
                       perform Deleta-ARQ-IFC

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if
                    perform until not valid-T01-C074-3
                       initialize REG-IFM01
                       move IFC01-CODIGO to IFM01-CODIGO
                       move high-value   to IFM01-PROGRESSIVO
                       start ARQ-IFM01 key is < IFM01-CHAVE
                       read ARQ-IFM01 previous with no lock
                       if not valid-ARQ-IFM01 or 
                                         IFC01-CODIGO not = IFM01-CODIGO
                          move 1 to IFM01-PROGRESSIVO
                       else
                          add  1 to IFM01-PROGRESSIVO
                       end-if
                       move IFC01-CODIGO      to IFM01-CODIGOx
                       move IFM01-PROGRESSIVO to IFM01-PROGRESSIVOx

                       initialize REG-IFM01
                       move REG-IFM01x         to REG-IFM01
                       move T01-C074-3-DATA    to IFM01-DATLANCAMENTO 
                       move T01-C074-3-TIPO    to IFM01-TIPO
                       move T01-C074-3-CAMINHO to IFM01-CAMINHO

                       write REG-IFM01
                       if not valid-ARQ-IFM01
                          move "Erro na gravação do arquivo ARQ-IFM01." 
                                                        to wrk-message-1
                          string "Status: " STAT-ARQ-IFM01 
                                                      into wrk-message-2
                          perform mensagem
                          perform Deleta-ARQ-IFC

                          move 'S' to wrk-erro-btn-gravar

                          exit paragraph
                       end-if

                       read T01-C074-3 next with no lock
                    end-perform
                 end-if
                 |Fim ARQ-IFM01

                 |ARQ-IFS01
                 initialize REG-IFS01x
                 move REG-IFS01 to REG-IFS01x

                 if wrk-linha-grid-4 > 1
                    initialize REG-T01-C074-4
                    move wrk-codigo-ifc to T01-C074-4-CODIGO
                    move low-value      to T01-C074-4-PROGRESSIVO
                    start T01-C074-4 key is >= T01-C074-4-CHAVE
                    read T01-C074-4 next with no lock
                    if not valid-T01-C074-4
                       move "Não foi possível localizar o registro" 
                                                        to wrk-message-1
                       string "no T01-C074-4. Status: " STAT-T01-C074-4 
                                                      into wrk-message-2
                       perform mensagem
                       perform Deleta-ARQ-IFC

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if
                    perform until not valid-T01-C074-4
                       initialize REG-IFS01
                       move IFC01-CODIGO to IFS01-CODIGO
                       move high-value   to IFS01-PROGRESSIVO
                       start ARQ-IFS01 key is < IFS01-CHAVE
                       read ARQ-IFS01 previous with no lock
                       if not valid-ARQ-IFS01 or
                                         IFC01-CODIGO not = IFS01-CODIGO
                          move 1 to IFS01-PROGRESSIVO
                       else
                          add  1 to IFS01-PROGRESSIVO
                       end-if
                       move IFC01-CODIGO      to IFS01-CODIGOx
                       move IFS01-PROGRESSIVO to IFS01-PROGRESSIVOx

                       initialize REG-IFS01
                       move REG-IFS01x      to REG-IFS01
                       move usu-codigo      to IFS01-OPERADOR
                       move T01-C074-4-DATA to IFS01-DATSITUACAO
                       move T01-C074-4-HORA to IFS01-HORSITUACAO
                       move T01-C074-4-TIPO to IFS01-TIPO
                       move T01-C074-4-OBS1 to IFS01-OBSERVACAO1
                       move T01-C074-4-OBS2 to IFS01-OBSERVACAO2
                       move T01-C074-4-OBS3 to IFS01-OBSERVACAO3
                       move T01-C074-4-OBS4 to IFS01-OBSERVACAO4
                       move T01-C074-4-OBS5 to IFS01-OBSERVACAO5

                       write REG-IFS01
                       if not valid-ARQ-IFS01
                          move "Erro na gravação do arquivo ARQ-IFS01." 
                                                        to wrk-message-1
                          string "Status: " STAT-ARQ-IFS01 
                                                      into wrk-message-2
                          perform mensagem
                          perform Deleta-ARQ-IFC

                          move 'S' to wrk-erro-btn-gravar

                          exit paragraph
                       end-if

                       read T01-C074-4 next with no lock
                    end-perform
                 else
                    initialize REG-IFS01
                    move IFC01-CODIGO to IFS01-CODIGO
                    move high-value   to IFS01-PROGRESSIVO
                    start ARQ-IFS01 key is < IFS01-CHAVE
                    read ARQ-IFS01 previous with no lock
                    if not valid-ARQ-IFS01 or
                                         IFC01-CODIGO not = IFS01-CODIGO
                       move 1 to IFS01-PROGRESSIVO
                    else
                       add  1 to IFS01-PROGRESSIVO
                    end-if
                    move IFC01-CODIGO      to IFS01-CODIGOx
                    move IFS01-PROGRESSIVO to IFS01-PROGRESSIVOx

                    initialize REG-IFS01
                    move REG-IFS01x to REG-IFS01
                    move usu-codigo to IFS01-OPERADOR
                    move 1          to IFS01-TIPO

                    write REG-IFS01
                    if not valid-ARQ-IFS01
                       move "Erro na gravação do arquivo ARQ-IFS01." 
                                                        to wrk-message-1
                       string "Status: " STAT-ARQ-IFS01 
                                                      into wrk-message-2
                       perform mensagem           
                       perform Deleta-ARQ-IFC

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if
                 end-if 
                 |Fim ARQ-IFS01

                 move "Gravação realizada com sucesso!" to wrk-message-1
                 string "Código: " IFC01-CODIGO into wrk-message-2
                 perform mensagem-i

                 initialize t1-Ta-1-Value
                            t1-Pg-2-Visible
                            t1-Pg-4-Visible
                 move 1  to t1-Ta-1-Value
                            t1-Pg-1-Visible

                 perform inicio

                 inquire t1-Ef-IFC01-CODIGO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           else |Regravação
              |Protocolo 54.601
              if t1-Cm-2-Value(1:1) = 1 or spaces
                 move 'Deseja alterar o tipo da infração' 
                                                        to wrk-message-1
                 move 'de Notificação para Multa?' to wrk-message-2
                 set wrk-warning-type to true
                 set wrk-yes-no-type  to true
                 set wrk-default-2 to true
                 Call "mensagem" Using wrk-Message-Type
                                       wrk-Response-Type 
                                       wrk-message-1
                                       wrk-Message-2
                                       wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"
                                       
                 if wrk-response = 1
                    move 2 to wrk-tipo-combobox

                    move t1-Cm-2-Container(wrk-tipo-combobox) 
                                                        to t1-Cm-2-Value
                    modify t1-Cm-1-Tipo VALUE t1-Cm-2-Value  
                 end-if
              end-if  
              |ARQ-IFC01
              move t1-Cm-1-Value(1:1) to IFC01-ASSINADA
              move spaces             to IFC01-ORGINFLACAO
              move t1-Cm-2-Value(1:1) to IFC01-TIPO
              |Fim Protocolo 54.601

              if IFC01-DAT-VENCIMENTO = spaces or 
                 IFC01-DAT-VENCIMENTO not numeric
                 move zeros to IFC01-DAT-VENCIMENTO
              end-if

              rewrite REG-IFC01
              if not valid-ARQ-IFC01
                 move "Erro na regravação do arquivo ARQ-IFC01." 
                                                        to wrk-message-1
                 string "Status: " STAT-ARQ-IFC01     into wrk-message-2
                 perform mensagem

                 move 'S' to wrk-erro-btn-gravar

                 exit paragraph
              |Fim ARQ-IFC01
              else
                 |ARQ-IFI01
                 |********alteração de grid**********
                 initialize REG-T01-C074-5
                 move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
                 move low-value      to T01-C074-5-PROGRESSIVO
                 start T01-C074-5 key is >= T01-C074-5-CHAVE
                 read T01-C074-5 next with no lock
                 if not valid-T01-C074-5
                    initialize REG-T01-C074-5
                 end-if
      
                 perform until not valid-T01-C074-5
                    initialize REG-IFI01
                    move IFC01-CODIGO to IFI01-CODIGO
                    move low-value    to IFI01-CODINFLACAO
                    start ARQ-IFI01 key is >= IFI01-CHAVE
                    read ARQ-IFI01 next with no lock
                    if valid-ARQ-IFI01
                       perform until not valid-ARQ-IFI01 or 
                                         IFC01-CODIGO not = IFI01-CODIGO
      
                          if T01-C074-5-CODIGO = IFI01-CODINFLACAO and
                            (T01-C074-5-RESPONSABILIDADE 
                                            not = IFI01-RESPONSABILIDADE
                            or T01-C074-5-VALOR   not = IFI01-VALOR
                            or IFI01-MEDREALIZADA not = 
                                                T01-C074-5-MEDREALIZADA)
                             move T01-C074-5-VALOR   
                                               to IFI01-VALOR
                             move T01-C074-5-RESPONSABILIDADE 
                                               to IFI01-RESPONSABILIDADE
                             move IFC01-NRONOTIFICACAO 
                                               to IFI01-NOTIFICACAO
                             move T01-C074-5-MEDREALIZADA 
                                               to IFI01-MEDREALIZADA 
                             rewrite REG-IFI01
                             if not valid-ARQ-IFI01
                         move "Erro na regravação do arquivo ARQ-IFI01."
                                                        to wrk-message-1
                                string "Status: " STAT-ARQ-IFI01 
                                                      into wrk-message-2
                                perform mensagem

                                move 'S' to wrk-erro-btn-gravar

                                exit paragraph
                             end-if
                          end-if
      
                          read ARQ-IFI01 next with no lock
                       end-perform
                    end-if
      
                    read T01-C074-5 next with no lock
                 end-perform
                 |********fim**********

                 if wrk-linha-grid-1 > 1 and 
                               wrk-nro-itens-gd-1 not = wrk-contagem-gd1
                          
                    initialize REG-T01-C074-5
                    move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
                    move low-value      to T01-C074-5-PROGRESSIVO
                    start T01-C074-5 key is >= T01-C074-5-CHAVE
                    read T01-C074-5 next with no lock
                    if not valid-T01-C074-5
                       move "Não foi possível localizar o registro" 
                                                        to wrk-message-1
                       string "no arquivo T01-C074-5. Status: " 
                               STAT-T01-C074-5 into wrk-message-2
                       perform mensagem

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if

                    perform until not valid-T01-C074-5
                       initialize REG-IFI01
                       move IFC01-CODIGO      to IFI01-CODIGO
                       move T01-C074-5-CODIGO to IFI01-CODINFLACAO
                       read ARQ-IFI01 with no lock
                       if not valid-ARQ-IFI01 or IFC01-CODIGO 
                                                      not = IFI01-CODIGO
                          initialize REG-IFC99
                          move T01-C074-5-CODIGO to IFC99-CODIGO
                          read ARQ-IFC99 with no lock
                          if not valid-ARQ-IFC99
                             initialize REG-IFC99
                          end-if                 
   
                          move IFC01-CODIGO         to IFI01-CODIGO
                          move T01-C074-5-CODIGO    to IFI01-CODINFLACAO 
                          move IFC99-GRAU           to IFI01-GRAU
                          move IFC99-PONTOS         to IFI01-PONTOS
                          move T01-C074-5-VALOR     to IFI01-VALOR
                          move IFC99-VALCONSIDERADO 
                                               to IFI01-VALCONSIDERADO
                          move IFC99-VALREGULAMENTADO 
                                               to IFI01-LIMREGULAMENTADO
                          move T01-C074-5-RESPONSABILIDADE 
                                               to IFI01-RESPONSABILIDADE
                          move IFC01-NRONOTIFICACAO to IFI01-NOTIFICACAO
                          move IFC99-ARTIGO         to IFI01-ARTIGO
                          move T01-C074-5-MEDREALIZADA
                                                   to IFI01-MEDREALIZADA 
   
                          write REG-IFI01
                          if not valid-ARQ-IFI01
                           move "Erro na gravação do arquivo ARQ-IFI01."
                                                        to wrk-message-1
                             string "Status: " STAT-ARQ-IFI01 
                                                      into wrk-message-2
                             perform mensagem

                             move 'S' to wrk-erro-btn-gravar

                             exit paragraph
                          end-if
                       else
                          move T01-C074-5-CODIGO  to IFI01-CODINFLACAO  
                          move T01-C074-5-VALOR   to IFI01-VALOR
                          move T01-C074-5-RESPONSABILIDADE 
                                               to IFI01-RESPONSABILIDADE
                          move IFC01-NRONOTIFICACAO to IFI01-NOTIFICACAO
                          move T01-C074-5-MEDREALIZADA
                                                   to IFI01-MEDREALIZADA
                          rewrite REG-IFI01
                          if not valid-ARQ-IFI01
                         move "Erro na regravação do arquivo ARQ-IFI01."
                                                        to wrk-message-1
                             string "Status: " STAT-ARQ-IFI01 
                                                      into wrk-message-2
                             perform mensagem

                             move 'S' to wrk-erro-btn-gravar

                             exit paragraph
                          end-if
                       end-if                      

                       read T01-C074-5 next with no lock
                    end-perform
                 end-if
                 |Fim ARQ-IFI01

                 |ARQ-IFM01
                 |********alteração de grid**********
                 initialize REG-T01-C074-3
                 move wrk-codigo-ifc to T01-C074-3-CODIGO
                 move low-value      to T01-C074-3-PROGRESSIVO
                 start T01-C074-3 key is >= T01-C074-3-CHAVE
                 read T01-C074-3 next with no lock
                 if not valid-T01-C074-3
                    initialize REG-T01-C074-3
                 end-if
      
                 perform until not valid-T01-C074-3 
                    initialize REG-IFM01
                    move IFC01-CODIGO          to IFM01-CODIGO
                    move T01-C074-3-PROGRE-IFM to IFM01-PROGRESSIVO
                    read ARQ-IFM01 with no lock
                    if not valid-ARQ-IFM01
                       initialize REG-IFM01
                    end-if 

                    if    IFM01-DATLANCAMENTO = T01-C074-3-DATA 
                     and (IFM01-TIPO      not = T01-C074-3-TIPO
                     and  IFM01-CAMINHO       = T01-C074-3-CAMINHO)

                       move T01-C074-3-DATA    to IFM01-DATLANCAMENTO
                       move T01-C074-3-TIPO    to IFM01-TIPO
                       move T01-C074-3-CAMINHO to IFM01-CAMINHO
            
                       rewrite REG-IFM01
                       if not Valid-ARQ-IFM01
                          move "Não foi possivel regravar o arquivo"  
                                                        to wrk-message-1
                          string "ARQ-IFM01. Status: " Stat-ARQ-IFM01
                                                      into wrk-message-2
                          perform mensagem

                          move 'S' to wrk-erro-btn-gravar

                          exit paragraph
                       end-if
                    end-if
      
                    read T01-C074-3 next with no lock
                 end-perform
                 |********fim**********

                 if wrk-linha-grid-3 > 1 and 
                               wrk-contagem-gd3 not = wrk-nro-itens-gd-3
                    initialize REG-IFM01x
                    move REG-IFM01 to REG-IFM01x

                    initialize REG-T01-C074-3
                    move wrk-codigo-ifc to T01-C074-3-CODIGO
                    move low-value      to T01-C074-3-PROGRESSIVO
                    start T01-C074-3 key is >= T01-C074-3-CHAVE
                    read T01-C074-3 next with no lock
                    if not valid-T01-C074-3
                       move "Não foi possível localizar o registro" 
                                                        to wrk-message-1
                       string "no T01-C074-3. Status: " STAT-T01-C074-3 
                                                      into wrk-message-2
                       perform mensagem

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if

                    perform until not valid-T01-C074-3
                       move zeros  to wrk-progressivo-gd-3
                       move spaces to wrk-vai  

                       initialize REG-IFM01
                       move IFC01-CODIGO to IFM01-CODIGO
                       move low-value    to IFM01-PROGRESSIVO
                       start ARQ-IFM01 key is >= IFM01-CHAVE
                       read ARQ-IFM01 next with no lock
                       if not valid-ARQ-IFM01 or IFC01-CODIGO not = 
                                                            IFM01-CODIGO
                          initialize REG-IFM01
                          move IFC01-CODIGO to IFM01-CODIGO
                          move high-value   to IFM01-PROGRESSIVO
                          start ARQ-IFM01 key is < IFM01-CHAVE
                          read ARQ-IFM01 previous with no lock
                          if not valid-ARQ-IFM01 or 
                                         IFC01-CODIGO not = IFM01-CODIGO
                             move 1 to IFM01-PROGRESSIVO
                          else
                             add  1 to IFM01-PROGRESSIVO
                          end-if

                          move IFC01-CODIGO      to IFM01-CODIGOx
                          move IFM01-PROGRESSIVO to IFM01-PROGRESSIVOx
   
                          initialize REG-IFM01
                          move REG-IFM01x         to REG-IFM01
                          move T01-C074-3-DATA    to IFM01-DATLANCAMENTO 
                          move T01-C074-3-TIPO    to IFM01-TIPO
                          move T01-C074-3-CAMINHO to IFM01-CAMINHO
   
                          write REG-IFM01
                          if not valid-ARQ-IFM01
                           move "Erro na gravação do arquivo ARQ-IFM01." 
                                                        to wrk-message-1
                             string "Status: " STAT-ARQ-IFM01 
                                                      into wrk-message-2
                             perform mensagem

                             move 'S' to wrk-erro-btn-gravar

                             exit paragraph
                          end-if
                       end-if

                       perform until not valid-ARQ-IFM01 or 
                                         IFC01-CODIGO not = IFM01-CODIGO

                          if   T01-C074-3-DATA    = IFM01-DATLANCAMENTO 
                           and T01-C074-3-TIPO    = IFM01-TIPO          
                           and T01-C074-3-CAMINHO = IFM01-CAMINHO
                            move "N" to wrk-vai
                            exit perform
                         else
                            move "S" to wrk-vai
                         end-if

                          read ARQ-IFM01 next with no lock
                       end-perform

                       if wrk-vai = "S"
                          initialize REG-IFM01
                          move IFC01-CODIGO to IFM01-CODIGO
                          move high-value   to IFM01-PROGRESSIVO
                          start ARQ-IFM01 key is < IFM01-CHAVE
                          read ARQ-IFM01 previous with no lock
                          if not valid-ARQ-IFM01 or 
                                         IFC01-CODIGO not = IFM01-CODIGO
                             move 1 to IFM01-PROGRESSIVO
                          else
                             add  1 to IFM01-PROGRESSIVO
                          end-if

                          move IFC01-CODIGO      to IFM01-CODIGOx
                          move IFM01-PROGRESSIVO to IFM01-PROGRESSIVOx
   
                          initialize REG-IFM01
                          move REG-IFM01x         to REG-IFM01
                          move T01-C074-3-DATA    to IFM01-DATLANCAMENTO 
                          move T01-C074-3-TIPO    to IFM01-TIPO
                          move T01-C074-3-CAMINHO to IFM01-CAMINHO
   
                          write REG-IFM01
                          if not valid-ARQ-IFM01
                           move "Erro na gravação do arquivo ARQ-IFM01." 
                                                        to wrk-message-1
                             string "Status: " STAT-ARQ-IFM01 
                                                      into wrk-message-2
                             perform mensagem

                             move 'S' to wrk-erro-btn-gravar

                             exit paragraph
                          end-if
                       end-if

                       read T01-C074-3 next with no lock
                    end-perform
                 end-if
                 |Fim ARQ-IFM01

                 |ARQ-IFS01
                 |********alteração de grid**********
                 initialize REG-T01-C074-4
                 move wrk-codigo-ifc to T01-C074-4-CODIGO
                 move low-value      to T01-C074-4-PROGRESSIVO
                 start T01-C074-4 key is >= T01-C074-4-CHAVE
                 read T01-C074-4 next with no lock
                 if not valid-T01-C074-4
                    initialize REG-T01-C074-4
                 end-if
      
                 perform until not valid-T01-C074-4
                    initialize REG-IFS01
                    move IFC01-CODIGO          to IFS01-CODIGO
                    move T01-C074-4-PROGRE-IFS to IFS01-PROGRESSIVO
                    read ARQ-IFS01 with no lock
                    if valid-ARQ-IFS01
                       move T01-C074-4-DATA to IFS01-DATSITUACAO
                       move T01-C074-4-TIPO to IFS01-TIPO
                       move T01-C074-4-HORA to IFS01-HORSITUACAO
                       move T01-C074-4-OBS1 to IFS01-OBSERVACAO1
                       move T01-C074-4-OBS2 to IFS01-OBSERVACAO2
                       move T01-C074-4-OBS3 to IFS01-OBSERVACAO3
                       move T01-C074-4-OBS4 to IFS01-OBSERVACAO4
                       move T01-C074-4-OBS5 to IFS01-OBSERVACAO5
            
                       rewrite REG-IFS01
                       if not Valid-ARQ-IFS01
                          move "Não foi possivel regravar o arquivo"  
                                                        to wrk-message-1
                          string "ARQ-IFS01. Status: " STAT-ARQ-IFS01
                                                      into wrk-message-2
                          perform mensagem

                          move 'S' to wrk-erro-btn-gravar

                          exit paragraph
                       end-if
                    end-if 
     
                    read T01-C074-4 next with no lock
                 end-perform
                 |********fim**********

                 if wrk-linha-grid-4 > 1 and 
                               wrk-contagem-gd4 not = wrk-nro-itens-gd-4
                    initialize REG-IFS01x
                    move REG-IFS01 to REG-IFS01x

                    initialize REG-T01-C074-4 
                    move wrk-codigo-ifc to T01-C074-4-CODIGO
                    move low-value      to T01-C074-4-PROGRESSIVO
                    start T01-C074-4 key is >= T01-C074-4-CHAVE
                    read T01-C074-4 next with no lock
                    if not valid-T01-C074-4
                       move "Não foi possível localizar o registro" 
                                                        to wrk-message-1
                       string "no T01-C074-4. Status: " STAT-T01-C074-4 
                                                      into wrk-message-2
                       perform mensagem

                       move 'S' to wrk-erro-btn-gravar

                       exit paragraph
                    end-if

                    perform until not valid-T01-C074-4
                       move zeros  to wrk-progressivo-gd-4
                       move spaces to wrk-vai

                       initialize REG-IFS01
                       move IFC01-CODIGO to IFS01-CODIGO
                       move low-value    to IFS01-PROGRESSIVO
                       start ARQ-IFS01 key is >= IFS01-CHAVE
                       read ARQ-IFS01 next with no lock
                       if not valid-ARQ-IFS01 or IFC01-CODIGO not =
                                                            IFS01-CODIGO
                          initialize REG-IFS01
                          move IFC01-CODIGO to IFS01-CODIGO
                          move high-value   to IFS01-PROGRESSIVO
                          start ARQ-IFS01 key is < IFS01-CHAVE
                          read ARQ-IFS01 previous with no lock
                          if not valid-ARQ-IFS01 or 
                                         IFC01-CODIGO not = IFS01-CODIGO
                             move 1 to IFS01-PROGRESSIVO
                          else
                             add  1 to IFS01-PROGRESSIVO
                          end-if

                          move IFC01-CODIGO      to IFS01-CODIGOx
                          move IFS01-PROGRESSIVO to IFS01-PROGRESSIVOx
   
                          initialize REG-IFS01
                          move REG-IFS01x      to REG-IFS01
                          move usu-codigo      to IFS01-OPERADOR
                          move T01-C074-4-DATA to IFS01-DATSITUACAO
                          move T01-C074-4-HORA to IFS01-HORSITUACAO
                          move T01-C074-4-TIPO to IFS01-TIPO
                          move T01-C074-4-OBS1 to IFS01-OBSERVACAO1
                          move T01-C074-4-OBS2 to IFS01-OBSERVACAO2
                          move T01-C074-4-OBS3 to IFS01-OBSERVACAO3
                          move T01-C074-4-OBS4 to IFS01-OBSERVACAO4
                          move T01-C074-4-OBS5 to IFS01-OBSERVACAO5
   
                          write REG-IFS01
                          if not valid-ARQ-IFS01
                           move "Erro na gravação do arquivo ARQ-IFS01." 
                                                        to wrk-message-1
                             string "Status: " STAT-ARQ-IFS01 
                                                      into wrk-message-2
                             perform mensagem

                             move 'S' to wrk-erro-btn-gravar

                             exit paragraph
                          end-if
                       end-if

                       perform until not valid-ARQ-IFS01 or 
                                         IFC01-CODIGO not = IFS01-CODIGO

                          if T01-C074-4-DATA = IFS01-DATSITUACAO and
                             T01-C074-4-HORA = IFS01-HORSITUACAO and
                             T01-C074-4-TIPO = IFS01-TIPO        and 
                             T01-C074-4-OBS1 = IFS01-OBSERVACAO1 and
                             T01-C074-4-OBS2 = IFS01-OBSERVACAO2 and 
                             T01-C074-4-OBS3 = IFS01-OBSERVACAO3 and
                             T01-C074-4-OBS4 = IFS01-OBSERVACAO4 and 
                             T01-C074-4-OBS5 = IFS01-OBSERVACAO5
                             move "N" to wrk-vai
                             exit perform
                          else
                             move "S" to wrk-vai
                          end-if

                          read ARQ-IFS01 next with no lock
                       end-perform

                       if wrk-vai = "S"
                          initialize REG-IFS01
                          move IFC01-CODIGO to IFS01-CODIGO
                          move high-value   to IFS01-PROGRESSIVO
                          start ARQ-IFS01 key is < IFS01-CHAVE
                          read ARQ-IFS01 previous with no lock
                          if not valid-ARQ-IFS01 or 
                                         IFC01-CODIGO not = IFS01-CODIGO
                             move 1 to IFS01-PROGRESSIVO
                          else
                             add  1 to IFS01-PROGRESSIVO
                          end-if

                          move IFC01-CODIGO      to IFS01-CODIGOx
                          move IFS01-PROGRESSIVO to IFS01-PROGRESSIVOx
   
                          initialize REG-IFS01
                          move REG-IFS01x      to REG-IFS01
                          move usu-codigo      to IFS01-OPERADOR
                          move T01-C074-4-DATA to IFS01-DATSITUACAO
                          move T01-C074-4-HORA to IFS01-HORSITUACAO
                          move T01-C074-4-TIPO to IFS01-TIPO
                          move T01-C074-4-OBS1 to IFS01-OBSERVACAO1
                          move T01-C074-4-OBS2 to IFS01-OBSERVACAO2
                          move T01-C074-4-OBS3 to IFS01-OBSERVACAO3

                          move T01-C074-4-OBS4 to IFS01-OBSERVACAO4
                          move T01-C074-4-OBS5 to IFS01-OBSERVACAO5
   
                          write REG-IFS01
                          if not valid-ARQ-IFS01
                           move "Erro na gravação do arquivo ARQ-IFS01." 
                                                        to wrk-message-1
                             string "Status: " STAT-ARQ-IFS01 
                                                      into wrk-message-2
                             perform mensagem

                             move 'S' to wrk-erro-btn-gravar

                             exit paragraph
                          end-if
                       end-if

                       read T01-C074-4 next with no lock
                    end-perform
                 end-if

                 |Protocolo 54.639
                 if wrk-tipo-multa-ant not = t1-Cm-2-Value(1:1)
                    initialize REG-IFS01
                    move IFC01-CODIGO to IFS01-CODIGO
                    move high-value   to IFS01-PROGRESSIVO
                    start ARQ-IFS01 key is < IFS01-CHAVE
                    read ARQ-IFS01 previous with no lock
                    if not valid-ARQ-IFS01 or 
                                   IFC01-CODIGO not = IFS01-CODIGO
                       move 1 to IFS01-PROGRESSIVO
                    else
                       add  1 to IFS01-PROGRESSIVO
                    end-if

                    move IFC01-CODIGO      to IFS01-CODIGOx
                    move IFS01-PROGRESSIVO to IFS01-PROGRESSIVOx

                    accept wrk-data-inv from date YYYYMMDD

                    move wrk-data-inv-r-dia to IFS01-DATSITUACAO-R-DIAx
                    move wrk-data-inv-r-mes to IFS01-DATSITUACAO-R-MESx
                    move wrk-data-inv-r-ano to IFS01-DATSITUACAO-R-ANOx
         
                    accept wrk-hora-lancamento from time 
                    compute wrk-hora-lancamento = 
                                           wrk-hora-lancamento / 1000000
                    move wrk-hora-lancamento to IFS01-HORSITUACAOx

                    initialize REG-IFS01
                    move REG-IFS01x         to REG-IFS01
                    move usu-codigo         to IFS01-OPERADOR
                    move T01-C074-4-TIPO    to IFS01-TIPO

                    if t1-Cm-2-Value(1:1) = 1 and wrk-tipo-multa-ant = 2
                       move 'Multa transformada em Notificação' 
                                                    to IFS01-OBSERVACAO1
                    else
                       move 'Notificação transformada em Multa'
                                                    to IFS01-OBSERVACAO1
                    end-if

                    write REG-IFS01
                    if not valid-ARQ-IFS01
                     move "Erro na gravação do arquivo ARQ-IFS01." 
                                                        to wrk-message-1
                       string "Status: " STAT-ARQ-IFS01 
                                                      into wrk-message-2
                       perform mensagem

                       move 'S' to wrk-erro-btn-gravar
                       exit paragraph
                    end-if
                 end-if
                 |Fim Protocolo 54.639
                 |Fim ARQ-IFS01
                 move "Regravação realizada com sucesso!" 
                                                        to wrk-message-1
                 perform mensagem-i

                 initialize t1-Ta-1-Value
                            t1-Pg-1-Visible
                            t1-Pg-2-Visible
                            t1-Pg-4-Visible
                 move 1  to t1-Ta-1-Value
                            t1-Pg-1-Visible

                 perform inicio

                 inquire t1-Ef-IFC01-CODIGO id in control-id
                 move 4 to accept-control
                 exit paragraph

                 exit paragraph
              end-if
           end-if
           .  
      *
       t1-Pb-Exclui-Pg2-Link.
           if wrk-progressivo-gd-1 = zeros
              move "Selecione um registro para continuar." 
                                                        to wrk-message-1
              perform mensagem
              exit paragraph
           end-if

           move 1 to wrk-prgantnovo
           move "Deseja excluir o registro selecionado?" 
                                                        to wrk-message-1
           set wrk-warning-type to true
           set wrk-yes-no-type  to true
           set wrk-default-2 to true
           Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                          wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem"
                                 
           if wrk-response = 1
              initialize REG-T01-C074-5
              move wrk-codigo-ifc       to T01-C074-5-CODIGO-IFC
              move wrk-progressivo-gd-1 to T01-C074-5-PROGRESSIVO
              read T01-C074-5 with no lock
              if not valid-T01-C074-5
                 move "Erro ao localizar o registro." to wrk-message-1
                 perform mensagem
                 exit paragraph
              end-if
              delete T01-C074-5
              if not valid-T01-C074-5
                 move "Erro na exclusão" to wrk-message-1
                 set wrk-error-type to true
                 set wrk-ok-type      to true
                 Call "mensagem" Using wrk-Message-Type, 
                                       wrk-Response-Type, 
                                       wrk-message-1,
                                       wrk-Message-2,
                                       wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"
                 exit paragraph
              end-if
              initialize REG-IFI01
              move IFC01-CODIGO to IFI01-CODIGO
              move low-value    to IFI01-CODINFLACAO
              start ARQ-IFI01 key is >= IFI01-CHAVE
              read ARQ-IFI01 next with no lock
              if not valid-ARQ-IFI01
                 perform Limpa-Grid-Pg2

                 |só apaga do grid
                 initialize REG-T01-C074-5
                 move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
                 move low-value      to T01-C074-5-PROGRESSIVO
                 start T01-C074-5 key is >= T01-C074-5-CHAVE
                 read T01-C074-5 next with no lock

                 perform until not valid-T01-C074-5
                    move T01-C074-5-CODIGO    to Gd-1-Codigo
                    move T01-C074-5-DESCRICAO to Gd-1-Descricao
                    move T01-C074-5-PONTUACAO to Gd-1-Pontuacao
                    move T01-C074-5-VALOR     to Gd-1-Valor
         
                    add 1 to wrk-linha-grid-1
         
                    modify t1-Gd-1, NUM-ROWS wrk-linha-grid-1
                                  RECORD-TO-ADD t1-Gd-1-Record
         
                    modify t1-Gd-1 x=1 y= wrk-linha-grid-1 
                    hidden-data T01-C074-5-PROGRESSIVO

                    read T01-C074-5 next with no lock
                 end-perform
                 initialize REG-IFI01
                 move spaces to wrk-IFI01-RESPONSABILIDADE
                                wrk-IFI01-CODINFLACAO
                 perform Atualiza-Pg-2
              else
                 perform until not valid-ARQ-IFI01 or 
                                         IFC01-CODIGO not = IFI01-CODIGO
 
                    if T01-C074-5-CODIGO = IFI01-CODINFLACAO
                       exit perform
                    end-if

                    read ARQ-IFI01 next with no lock
                 end-perform
                 
                 delete ARQ-IFI01
                 if not valid-ARQ-IFI01
                    move 1 to  wrk-prgantnovo
                    initialize wrk-texto-msg
                    move "Erro na exclusão." to wrk-message-1
                    set wrk-error-type to true
                    set wrk-ok-type      to true
                    Call "mensagem" Using wrk-Message-Type, 
                                          wrk-Response-Type, 
                                          wrk-message-1,
                                          wrk-Message-2,
                                          wrk-Message-3
                    on overflow perform call-error end-call
                    Cancel "mensagem"
                 else
                    initialize REG-IFI01
                    move spaces to wrk-IFI01-RESPONSABILIDADE
                                   wrk-IFI01-CODINFLACAO
                    perform Atualiza-Pg-2
                    perform Limpa-Grid-Pg2

                    |preenche grid
                    initialize REG-T01-C074-5
                    move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
                    move low-value      to T01-C074-5-PROGRESSIVO
                    start T01-C074-5 key is >= T01-C074-5-CHAVE
                    read T01-C074-5 next with no lock
   
                    perform until not valid-T01-C074-5
                       move T01-C074-5-CODIGO    to Gd-1-Codigo
                       move T01-C074-5-DESCRICAO to Gd-1-Descricao
                       move T01-C074-5-PONTUACAO to Gd-1-Pontuacao
                       move T01-C074-5-VALOR     to Gd-1-Valor
            
                       add 1 to wrk-linha-grid-1
            
                       modify t1-Gd-1, NUM-ROWS wrk-linha-grid-1
                                     RECORD-TO-ADD t1-Gd-1-Record
            
                       modify t1-Gd-1 x=1 y= wrk-linha-grid-1 
                       hidden-data T01-C074-5-PROGRESSIVO
   
                       read T01-C074-5 next with no lock
                    end-perform
                 end-if
              end-if
              move zeros to wrk-progressivo-gd-1
 
              inquire t1-Ef-IFI01-CODINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t1-Ef-IFI01-VALOR-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Pb-exclui-Link.
           if IFC01-CODIGO = zeros
              move "Carregue um registro para continuar." 
                                                        to wrk-message-1
              perform mensagem
              exit paragraph
           end-if

           move zeros to wrk-codigo
           move IFC01-CODIGO to wrk-codigo

           move 1 to wrk-prgantnovo
           move "Deseja excluir o registro carregado?" 
                                                     to wrk-message-1
           set wrk-warning-type to true
           set wrk-yes-no-type  to true
           set wrk-default-2 to true
           Call "mensagem" Using wrk-Message-Type
                                 wrk-Response-Type 
                                 wrk-message-1
                                 wrk-Message-2
                                 wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem"
                                 
           if wrk-response = 1
              delete ARQ-IFC01
              if not valid-ARQ-IFC01   		           
                 move 1 to  wrk-prgantnovo
                 initialize wrk-texto-msg
                 move "Erro na exclusão do arquivo ARQ-IFC01." 
                                                        to wrk-message-1
                 string "Status: " STAT-ARQ-IFC01 into wrk-message-2

                 set wrk-error-type to true
                 set wrk-ok-type    to true
                 Call "mensagem" Using wrk-Message-Type
                                       wrk-Response-Type
                                       wrk-message-1
                                       wrk-Message-2
                                       wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"  
                 exit paragraph     
              else
                 initialize REG-IFI01
                 move wrk-codigo to IFI01-CODIGO
                 move low-value  to IFI01-CODINFLACAO
                 start ARQ-IFI01 key is >= IFI01-CHAVE
                 read ARQ-IFI01 next with no lock
                 if not valid-ARQ-IFI01
                    initialize REG-IFI01
                 end-if

                 perform until not valid-ARQ-IFI01 or
                                           wrk-codigo not = IFI01-CODIGO
                    delete ARQ-IFI01
                    if not valid-ARQ-IFI01   		           
                       move 1 to  wrk-prgantnovo
                       initialize wrk-texto-msg
                       move "Erro na exclusão do arquivo ARQ-IFI01." 
                                                        to wrk-message-1
                       string "Status: " STAT-ARQ-IFI01 
                                                      into wrk-message-2
      
                       set wrk-error-type to true
                       set wrk-ok-type    to true
                       Call "mensagem" Using wrk-Message-Type
                                             wrk-Response-Type
                                             wrk-message-1
                                             wrk-Message-2
                                             wrk-Message-3
                       on overflow perform call-error end-call
                       Cancel "mensagem"
                       exit paragraph
                    end-if

                    read ARQ-IFI01 next with no lock
                 end-perform


                 initialize REG-IFM01
                 move wrk-codigo to IFM01-CODIGO
                 move low-value  to IFM01-PROGRESSIVO
                 start ARQ-IFM01 key is >= IFM01-CHAVE
                 read ARQ-IFM01 next with no lock
                 if not valid-ARQ-IFM01
                    initialize REG-IFM01
                 end-if

                 perform until not valid-ARQ-IFM01 or 
                                           wrk-codigo not = IFM01-CODIGO
                    delete ARQ-IFM01
                    if not valid-ARQ-IFM01   		           
                       move 1 to  wrk-prgantnovo
                       initialize wrk-texto-msg
                       move "Erro na exclusão do arquivo ARQ-IFM01." 
                                                        to wrk-message-1 
                       string "Status: " STAT-ARQ-IFM01 
                                                      into wrk-message-2
      
                       set wrk-error-type to true
                       set wrk-ok-type    to true
                       Call "mensagem" Using wrk-Message-Type
                                             wrk-Response-Type
                                             wrk-message-1
                                             wrk-Message-2
                                             wrk-Message-3
                       on overflow perform call-error end-call
                       Cancel "mensagem"
                       exit paragraph
                    end-if

                    read ARQ-IFM01 next with no lock
                 end-perform

                 initialize REG-IFR01
                 move wrk-codigo to IFR01-CODIGO
                 move low-value  to IFR01-PROGRESSIVO
                 start ARQ-IFR01 key is >= IFR01-CHAVE
                 read ARQ-IFR01 next with no lock
                 if not valid-ARQ-IFR01
                    initialize REG-IFR01
                 end-if
      
                 perform until not valid-ARQ-IFR01 or 
                                           wrk-codigo not = IFR01-CODIGO
                    delete ARQ-IFR01
                    if not valid-ARQ-IFR01   		           
                       move 1 to  wrk-prgantnovo
                       initialize wrk-texto-msg
                       move "Erro na exclusão do arquivo ARQ-IFR01." 
                                                        to wrk-message-1
                       string "Status: " STAT-ARQ-IFR01 
                                                      into wrk-message-2
      
                       set wrk-error-type to true
                       set wrk-ok-type    to true
                       Call "mensagem" Using wrk-Message-Type
                                             wrk-Response-Type
                                             wrk-message-1
                                             wrk-Message-2
                                             wrk-Message-3
                       on overflow perform call-error end-call
                       Cancel "mensagem"
                       exit paragraph
                    end-if
      
                    read ARQ-IFR01 next with no lock
                 end-perform

                 initialize REG-IFS01
                 move wrk-codigo to IFS01-CODIGO
                 move low-value  to IFS01-PROGRESSIVO
                 start ARQ-IFS01 key is >= IFS01-CHAVE
                 read ARQ-IFS01 next with no lock
                 if not valid-ARQ-IFS01
                    initialize REG-IFS01
                 end-if

                 perform until not valid-ARQ-IFS01 or
                                           wrk-codigo not = IFS01-CODIGO
                    delete ARQ-IFS01
                    if not valid-ARQ-IFS01   		           
                       move 1 to  wrk-prgantnovo
                       initialize wrk-texto-msg
                       move "Erro na exclusão do arquivo ARQ-IFS01." 
                                                        to wrk-message-1
                       string "Status: " STAT-ARQ-IFS01 
                                                      into wrk-message-2
      
                       set wrk-error-type to true
                       set wrk-ok-type    to true
                       Call "mensagem" Using wrk-Message-Type
                                             wrk-Response-Type
                                             wrk-message-1
                                             wrk-Message-2
                                             wrk-Message-3
                       on overflow perform call-error end-call
                       Cancel "mensagem"
                       exit paragraph
                    end-if

                    read ARQ-IFS01 next with no lock
                 end-perform
              
                 |Protocolo 54.544
                 initialize REG-IFP01
                 move wrk-codigo to IFP01-CODIGO
                 start ARQ-IFP01 key is >= IFP01-CHAVE
                 read ARQ-IFP01 next with no lock
                 if valid-ARQ-IFP01 and wrk-codigo = IFP01-CODIGO
                    perform until not valid-ARQ-IFP01 or 
                                           wrk-codigo not = IFP01-CODIGO 
                       delete ARQ-IFP01
                       if not valid-ARQ-IFP01   		           
                          move 1 to  wrk-prgantnovo
                          initialize wrk-texto-msg
                          move "Erro na exclusão do arquivo ARQ-IFP01." 
                                                        to wrk-message-1
                          string "Status: " STAT-ARQ-IFP01  
                                                      into wrk-message-2

         
                          set wrk-error-type to true
                          set wrk-ok-type    to true
                          Call "mensagem" Using wrk-Message-Type
                                                wrk-Response-Type
                                                wrk-message-1
                                                wrk-Message-2
                                                wrk-Message-3
                          on overflow perform call-error end-call
                          Cancel "mensagem"
                          exit paragraph
                       end-if

                       read ARQ-IFP01 next with no lock
                    end-perform
                 end-if
                 |Fim
              end-if
              perform inicio

              initialize t1-Ta-1-Value
                         t1-Pg-1-Visible
                         t1-Pg-2-Visible
                         t1-Pg-4-Visible
              move 1  to t1-Ta-1-Value
                         t1-Pg-1-Visible

              display t1

              inquire t1-Ef-IFC01-CODIGO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .


       Preenche-Gd-1.
           initialize REG-T01-C074-5
           move wrk-codigo-ifc to T01-C074-5-CODIGO-IFC
           move low-value      to T01-C074-5-PROGRESSIVO
           start T01-C074-5 key is >= T01-C074-5-CHAVE
           read T01-C074-5 next with no lock
           if not valid-T01-C074-5 or 
                              wrk-codigo-ifc not = T01-C074-5-CODIGO-IFC 
              initialize REG-T01-C074-5
           end-if
           
           perform until not valid-T01-C074-5 or
                              wrk-codigo-ifc not = T01-C074-5-CODIGO-IFC 
              move T01-C074-5-CODIGO    to Gd-1-Codigo
              move T01-C074-5-DESCRICAO to Gd-1-Descricao
              move T01-C074-5-PONTUACAO to Gd-1-Pontuacao
              move T01-C074-5-VALOR     to Gd-1-Valor
   
              add 1 to wrk-linha-grid-1
   
              modify t1-Gd-1, NUM-ROWS wrk-linha-grid-1 
                            RECORD-TO-ADD t1-Gd-1-Record
   
              modify t1-Gd-1 x=1 y=wrk-linha-grid-1 
                     hidden-data T01-C074-5-PROGRESSIVO

              move zeros to wrk-progressivo-gd-1

              read T01-C074-5 next with no lock
           end-perform
           .

       Preenche-Gd-3.
           initialize REG-T01-C074-3
           move wrk-codigo-ifc to T01-C074-3-CODIGO
           move low-value      to T01-C074-3-PROGRESSIVO
           start T01-C074-3 key is >= T01-C074-3-CHAVE
           read T01-C074-3 next with no lock
           if not valid-T01-C074-3 or 
                                  wrk-codigo-ifc not = T01-C074-3-CODIGO
              initialize REG-T01-C074-3
           end-if

           perform until not valid-T01-C074-3 or 
                                  wrk-codigo-ifc not = T01-C074-3-CODIGO
              string T01-C074-3-DATA-R-DIA "/"  
                     T01-C074-3-DATA-R-MES "/"
                     T01-C074-3-DATA-R-ANO 
                     into Gd-3-Data
   
              move T01-C074-3-TIPO to Gd-3-Tipo
   
              add 1 to wrk-linha-grid-3
   
              modify t1-Gd-3, NUM-ROWS wrk-linha-grid-3
                            RECORD-TO-ADD t1-Gd-3-Record
   
              modify t1-Gd-3 x=1 y= wrk-linha-grid-3
              hidden-data T01-C074-3-PROGRESSIVO
   
              move zeros to wrk-progressivo-gd-3

              read T01-C074-3 next with no lock
           end-perform
           .

       Preenche-Gd-4.
           initialize REG-T01-C074-4
           |Protocolo 54.609
           move IFC01-CODIGOz to T01-C074-4-CODIGO
           |Fim
           move low-value     to T01-C074-4-PROGRESSIVO
           start T01-C074-4 key is >= T01-C074-4-CHAVE
           read T01-C074-4 next with no lock
           if not valid-T01-C074-4 or
                                   IFC01-CODIGOz not = T01-C074-4-CODIGO
              initialize REG-T01-C074-4
           end-if

           perform until not valid-T01-C074-4 or
                                   IFC01-CODIGOz not = T01-C074-4-CODIGO

              initialize t1-Gd-4-Record

              string T01-C074-4-DATA-R-DIA "/"  
                     T01-C074-4-DATA-R-MES "/"
                     T01-C074-4-DATA-R-ANO 
                     into Gd-4-Data
   
              string T01-C074-4-HORA(1:2)":"
                     T01-C074-4-HORA(3:2)
                     into Gd-4-Hora
   
              evaluate T01-C074-4-TIPO
                 when 1
                    move 'Lançada'    to Gd-4-Tipo
                 when 2
                    move 'Em Recurso' to Gd-4-Tipo
                 when 3
                    move 'Cancelada'  to Gd-4-Tipo
                 when 4
                    move 'Aguardando' to Gd-4-Tipo
                 when 5
                    move 'Baixada'    to Gd-4-Tipo
              end-evaluate

              |Protocolo 54.639
              move T01-C074-4-OBS1 to Gd-4-Obs

              initialize REG-USU
              move T01-C074-4-OPERADOR to USU-CODIGO
              read ARQ-USU with no lock
              if not valid-ARQ-USU
                 initialize REG-USU
              end-if
              move USU-NOME to Gd-4-Operador 
              |Fim
   
              add 1 to wrk-linha-grid-4
   
              modify t1-Gd-4, NUM-ROWS wrk-linha-grid-4
                            RECORD-TO-ADD t1-Gd-4-Record
   
              modify t1-Gd-4 x=1 y= wrk-linha-grid-4
              hidden-data T01-C074-4-PROGRESSIVO
   
              move zeros to wrk-progressivo-gd-4

              read T01-C074-4 next with no lock
           end-perform
           .
      *
       t1-Pb-Carr-Link.
           | Inicializa variaveis
           move 'N'    to wrk-erro-browser
           move Spaces to wrk-arquivo-dir

           | Chamada padrão - Browser Pesquisa

           initialize reg-0051
           move ' '                           to reg-0051-drive
           move '\Comp-3\Ac-dados\ImgMultas\' to reg-0051-pasta
           move 2                             to reg-0051-tipo
           move 0                             to reg-0051-erro
   
           Call 'ROT-0051' Using reg-0051-drive,
                                 reg-0051-pasta,
                                 reg-0051-tipo,
                                 reg-0051-erro

              On Overflow
                 Continue
           End-Call

           Cancel 'ROT-0051'
   
           move '\COMP-3\AC-DADOS\IMGMULTAS\' to opnsav-default-dir
           move "Arquivos JPG (*.jpg)|*.jpg"  to opnsav-filters
           move 1                             to opnsav-default-filter
           move "Seleção de Arquivo"          to opnsav-title
           move spaces                        to Opnsav-Filename
           
           Call 'C$OPENSAVEBOX' Using Opensave-Open-Box 
                                      Opensave-Data 
                                      Opnsav-Default-Dir

              On Overflow
                 move 'S' to wrk-erro-browser
                 Continue
           End-Call

           Cancel 'C$OPENSAVEBOX'
        
           if wrk-erro-browser = 'N' 
              Move Opnsav-Filename to wrk-arquivo-dir
           end-if
            
           if Opnsav-Filename not = spaces
              move zeros to wrk-K
              move 256 to wrk-I
              perform until wrk-arquivo-dir(wrk-I:1) = '\'
                 subtract 1 from wrk-I
                 add 1 to wrk-K
              end-perform
              subtract 1 from wrk-K
              add 1 to wrk-I
   
              move spaces to wrk-destino
              string '\Comp-3\Ac-dados\ImgMultas\'
                     wrk-arquivo-dir(wrk-I:wrk-K)into wrk-destino
   
              move zeros to wrk-erro
              call 'C$COPY' using wrk-arquivo-dir wrk-destino
                            GIVING wrk-erro
              cancel 'C$COPY'   
    
              if wrk-erro not > zeros
                 call 'C$DELETE' using wrk-arquivo-dir
              end-if

              move wrk-destino to IFM01-CAMINHO
              modify t1-Ef-IFM01-CAMINHO value IFM01-CAMINHO
           end-if

           perform Foto-Escolhida
           .
      *
       t1-Pb-Vis-Link.
           if IFM01-CAMINHO not = spaces
              perform acu-t4-routine
   
              inquire t1-Pb-Inclui-Pg4 id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t4-Pb-Sair-Bef-Procedure.
           perform trata-barra-funcoes
           modify t4-Pb-Sair bitmap-handle = tripao2-bmp
           modify t4-Pb-Sair style         = pbs-framed
           modify t4-Pb-Sair bitmap-number = 25
           .
      *
       t4-Pb-Sair-Aft-Procedure.
           modify t4-Pb-Sair bitmap-handle = tripao2-bmp
           modify t4-Pb-Sair bitmap-number = 25
           modify t4-Pb-Sair flat
           .
      *
       t4-Pb-Sair-Link.
           perform acu-t4-exit
           .
      
      *
       t4-Aft-Initdata.
           call "w$bitmap" using wbitmap-destroy, wrk-imagem-handle
           cancel "w$bitmap"
      
           initialize wrk-imagem-handle

           | Carregar a imagem cinza antes para ficar por baixo
           move Spaces to wrk-imagem
           move '\Comp-3\Ac-Progr\Acucobol\cinza.jpg' to wrk-imagem
           initialize wrk-imagem-handle

           Call 'W$BITMAP' Using wbitmap-load, wrk-imagem
                           Giving wrk-imagem-handle

           modify t4-Bt-1, Bitmap-Handle wrk-imagem-handle
           Display t4-Bt-1

           |Mostrar a Imagem
           move Spaces to wrk-imagem
           move IFM01-CAMINHO to wrk-imagem
           initialize wrk-imagem-handle
      
           Call 'W$BITMAP' Using wbitmap-load, wrk-imagem
                           Giving wrk-imagem-handle
      
           modify t4-Bt-1, Bitmap-Handle wrk-imagem-handle
           Display t4-Bt-1
           .

       Foto-Escolhida.
           move IFM01-CAMINHO to wrk-foto
      
           Call "C$COPY" using opnsav-filename wrk-foto
           cancel "C$COPY"
      
           call "C$TOUPPER" using wrk-foto value 56
      
           move spaces to wrk-cmd
           string 
                 "\COMP-3\AC-PROGR\ACUCOBOL\ImageMagick\fotogrande.bat "
                                                  wrk-foto into wrk-cmd
           call "C$SYSTEM" using wrk-cmd 8
      
           call "W$BITMAP" using wbitmap-load wrk-foto
                          giving Foto-jpg

           modify t4-Bt-1, BITMAP-HANDLE foto-jpg
      
           move Spaces to wrk-Caminho-da-Foto
           move wrk-foto to wrk-Caminho-da-Foto
           .

       Deleta-ARQ-IFC. 
           delete ARQ-IFC01
           if not valid-ARQ-IFC01
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              move "Erro na exclusão." to wrk-message-1
              set wrk-error-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, 
                                    wrk-Response-Type, 
                                    wrk-message-1,
                                    wrk-Message-2,
                                    wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
           end-if
           .
      *
       t1-Fr-3a-Cm-1-Aft-Procedure.
           if t1-cm-1-value = "Sim"
              move 1   to wrk-assinada
              move "S" to IFC01-ASSINADA
           else
              move 2   to wrk-assinada
              move "N" to IFC01-ASSINADA
           end-if
           .

           |Protocolo 54.544
      *
       t1-Ef-IFC01-DAT-VENCIMENTO-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-IFC01-DAT-VENCIMENTO-Aft-Procedure.
           if IFC01-DAT-VENCIMENTO > 0
              move "@" to wrk-valid-data
              call "Rot-data" using IFC01-DAT-VENCIMENTO, wrk-valid-data
              cancel "Rot-data"
              if wrk-valid-data = "N"
                 move "Data Inválida." to wrk-message-1
                 perform mensagem
                 inquire t1-Ef-IFC01-DAT-VENCIMENTO id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
           end-if
           .
      *
       t1-Ef-IFC01-ORG-AUTUADOR-Aft-Procedure.
           if IFC01-ORG-AUTUADOR > 0
              |Protocolo 54.615
              initialize REG-IFC01y
              move REG-IFC01 to REG-IFC01y

              initialize REG-IFC01
              move low-value to IFC01-CODIGO
              start ARQ-IFC01 key is >= IFC01-CHAVE
              read ARQ-IFC01 next with no lock
              if not valid-ARQ-IFC01
                 initialize REG-IFC01
                 move REG-IFC01y to REG-IFC01
              else
                 perform until not valid-ARQ-IFC01
                    if IFC01-ORG-AUTUADOR = IFC01-ORG-AUTUADORy and
                       IFC01-AUTINFLACAO  = IFC01-AUTINFLACAOy  and
                       IFC01-CODIGO   not = IFC01-CODIGOy
                       string 'Infração já lançada para esse Orgão.' 
                                                      into wrk-message-1
                       perform mensagem 
                       initialize REG-IFC01
                       move REG-IFC01y to REG-IFC01 
                       inquire t1-Ef-IFC01-ORG-AUTUADOR id in control-id
                       move 4 to accept-control
                       exit paragraph
                    end-if

                    read ARQ-IFC01 next with no lock
                 end-perform
              end-if
              
              initialize REG-IFC01
              move REG-IFC01y to REG-IFC01

              initialize REG-FOR15
              move IFC01-ORG-AUTUADOR to FOR15-CODIGO
              read arq-for15 with no lock
              if not valid-arq-for15
                 move 'Orgão Autuador Inválido.' to wrk-message-1
                 perform mensagem
                 move spaces to wrk-IFC01-ORG-AUTUADOR
                 modify t1-Ef-wrk-IFC01-ORG-AUTUADOR 
                                            value wrk-IFC01-ORG-AUTUADOR
                 inquire t1-Ef-IFC01-ORG-AUTUADOR id in control-id
                 move 4 to accept-control
                 exit paragraph
              end-if
              move FOR15-NOME to wrk-IFC01-ORG-AUTUADOR
              modify t1-Ef-wrk-IFC01-ORG-AUTUADOR 
                                            value wrk-IFC01-ORG-AUTUADOR
              move 'N' to wrk-pagamento
           else
              move 'Indique um Orgão Autuador.' to wrk-message-1
              perform mensagem
              move spaces to wrk-IFC01-ORG-AUTUADOR
              modify t1-Ef-wrk-IFC01-ORG-AUTUADOR 
                                            value wrk-IFC01-ORG-AUTUADOR
              inquire t1-Ef-IFC01-ORG-AUTUADOR id in control-id
              move 4 to accept-control
              exit paragraph
              |Fim
           end-if
           .

       Preenche-IFC01-CODIGO.
           if wrk-acaexe = 'A'
              move IFC01-CODIGO to IFC01-CODIGOz
           else
              initialize REG-IFC01w
              move REG-IFC01 to REG-IFC01w

              initialize REG-IFC01
              move high-value to IFC01-CODIGO
              start ARQ-IFC01 key is < IFC01-CHAVE
              read ARQ-IFC01 previous with no lock
              if not valid-ARQ-IFC01
                 move 1 to IFC01-CODIGO
              else
                 add  1 to IFC01-CODIGO
              end-if
              move IFC01-CODIGO to IFC01-CODIGOz

              initialize REG-IFC01
              move REG-IFC01w to REG-IFC01
           end-if
           .
           |Fim Protocolo 54.544


           |Protocolo 54.601/54.609
      *
       t5-Aft-Initdata.
           move spaces to wrk-cod-t5
                          wrk-mascara-6
                          wrk-resposta

           move IFC01-CODIGO  to wrk-mascara-6
           move wrk-mascara-6 to wrk-cod-t5
           display t5
           .
      *
       t5-Pb-Abrir-Link.
           move 'A' to wrk-resposta
           move "S" to wrk-pergunta-btn
           perform acu-t5-exit
           .
      *
       t5-Pb-Continuar-Link.
           move 'C' to wrk-resposta
           move "S" to wrk-pergunta-btn
           perform acu-t5-exit
           .
      *
       t5-Pb-Sair-Link.
           move 'S' to wrk-resposta
           perform acu-t5-exit
           .
      *
       t1-Ef-wrk-aut-ant-Bef-Procedure.
           perform trata-barra-funcoes
           .
      *
       t1-Ef-wrk-aut-ant-Aft-Procedure.
           if IFC01-AUTINFLACAO-ANT not = spaces
              initialize REG-IFC01x
              move REG-IFC01 to REG-IFC01x

              initialize REG-IFC01
              move IFC01-AUTINFLACAO-ANTx to IFC01-AUTINFLACAO
              start ARQ-IFC01 key is >= CHAVE-IFC01-AUTINFLACAO
              read ARQ-IFC01 next with no lock
              if valid-ARQ-IFC01 and 
                              IFC01-AUTINFLACAO-ANTx = IFC01-AUTINFLACAO
                 move IFC01-CODIGO to wrk-cod-ant
                 modify t1-Ef-wrk-cod-ant value wrk-cod-ant

                 initialize REG-IFC01
                 move REG-IFC01x to REG-IFC01
              else
                 move 'Auto de Infração '   to wrk-message-1
                 move IFC01-AUTINFLACAO-ANT to wrk-message-2
                 move 'não lançado. Deseja continuar?' to wrk-message-3
                 set wrk-warning-type to true
                 set wrk-yes-no-type  to true
                 set wrk-default-2 to true
                 Call "mensagem" Using wrk-Message-Type
                                       wrk-Response-Type 
                                       wrk-message-1
                                       wrk-Message-2
                                       wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"
                                       
                 if wrk-response = 2
                    initialize REG-IFC01
                    move REG-IFC01x to REG-IFC01

                    move zeros to wrk-cod-ant
                    modify t1-Ef-wrk-cod-ant value wrk-cod-ant
                    inquire t1-Ef-wrk-aut-ant id in control-id
                    move 4 to accept-control
                    exit paragraph
                 else
                    move zeros to wrk-cod-ant
                    modify t1-Ef-wrk-cod-ant value wrk-cod-ant
                 end-if
              end-if
           end-if
           .
      *
       t1-Pb-Historico-Link.
           perform acu-t7-routine

           inquire t1-Pb-Historico id in control-id
           move 4 to accept-control
           exit paragraph
           .
      *
       t7-Aft-Initdata.
           perform Limpa-Grid-Pg5
           perform Preenche-IFC01-CODIGO
           perform Preenche-Gd-4
           .
      *
       t1-Ef-IFS01-OBSERVACAO5-Aft-Procedure.
           |Grava Temp
           perform Grava-T01-C074-4
           if wrk-ok = 'N'
              exit paragraph
           end-if

           initialize t1-Ta-1-Value
                      t1-Pg-1-Visible
                      t1-Pg-2-Visible
                      t1-Pg-4-Visible
                      key-status

           move 2 to t1-Ta-1-Value 
           move 2 to t1-Pg-2-Visible

           perform t1-Ta-1-Aft-Tabchg-Display

           display t1
           perform Limpa-Grid-Pg2      
           exit paragraph
           .
      *
       t1-Pb-Novo-Link.
           if IFC01-AUTINFLACAO = spaces
              inquire t1-Ef-IFC01-AUTINFLACAO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           if IFC01-VEICULO = spaces
              inquire t1-Ef-IFC01-VEICULO id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           |Grava Temp
           perform Grava-T01-C074-4
           if wrk-ok = 'N'
              exit paragraph
           end-if

           perform acu-t8-routine

           if wrk-t8-tipo > 0 and (wrk-t8-obs1 not = spaces or
                                   wrk-t8-obs2 not = spaces or
                                   wrk-t8-obs3 not = spaces or
                                   wrk-t8-obs4 not = spaces or
                                   wrk-t8-obs5 not = spaces)
              evaluate wrk-t8-tipo
                 when 1
                    move 1 to IFS01-TIPO
                    move 'Lançada'    to wrk-IFS01-TIPO

                    modify t1-Ef-IFS01-OBSERVACAO1 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO2 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO3 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO4 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO5 enabled true
                 when 2
                    move 2 to IFS01-TIPO
                    move 'Em Recurso' to wrk-IFS01-TIPO
                 when 3
                    move 3 to IFS01-TIPO
                    move 'Cancelada'  to wrk-IFS01-TIPO
                 when 4
                    move 4 to IFS01-TIPO
                    move 'Aguardando' to wrk-IFS01-TIPO

                    modify t1-Ef-IFS01-OBSERVACAO1 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO2 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO3 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO4 enabled true
                    modify t1-Ef-IFS01-OBSERVACAO5 enabled true
                 when 5 
                    move 5 to IFS01-TIPO
                    move 'Baixada'    to wrk-IFS01-TIPO
              end-evaluate

              move wrk-t8-obs1 to IFS01-OBSERVACAO1
              move wrk-t8-obs2 to IFS01-OBSERVACAO2
              move wrk-t8-obs3 to IFS01-OBSERVACAO3
              move wrk-t8-obs4 to IFS01-OBSERVACAO4
              move wrk-t8-obs5 to IFS01-OBSERVACAO5
              move wrk-t8-data to IFS01-DATSITUACAO
              move wrk-t8-hora to IFS01-HORSITUACAO              

              display t1

              inquire t1-Ef-IFS01-OBSERVACAO5 id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t8-Aft-Initdata.
           initialize reg-usu
           move ext-codusu to usu-codigo
           read arq-usu with no lock
           if valid-arq-usu
              string "Usuário: " usu-nome 
                                   delimited by size into wrk-barusuario
              modify t8-St-1-Handle panel-index 1
                                               panel-text wrk-barusuario

              initialize reg-emp00
              move 1 to emp00-codigo
              read arq-emp00 with no lock
              if valid-arq-emp00
                 Move emp00-nome to wrk-barempresa
              else
                 string "Empresa não encontrada"
                                   delimited by size into wrk-barempresa
              end-if
                 modify t8-St-1-Handle panel-index 2 
                                               panel-text wrk-barempresa
           end-if

           perform Inicio-t8
           .

       Inicio-t8.
           move zeros  to wrk-t8-cod
                          wrk-t8-data
                          wrk-t8-hora
                          wrk-t8-tipo
                        
           move spaces to wrk-t8-auto
                          wrk-t8-nom-tipo
                          wrk-t8-obs1
                          wrk-t8-obs2
                          wrk-t8-obs3
                          wrk-t8-obs4
                          wrk-t8-obs5

           move IFC01-CODIGO        to wrk-t8-cod
           move IFC01-AUTINFLACAO   to wrk-t8-auto
           
           accept wrk-data-inv from date YYYYMMDD

           move wrk-data-inv-r-dia to wrk-t8-data(1:2)
           move wrk-data-inv-r-mes to wrk-t8-data(3:2)
           move wrk-data-inv-r-ano to wrk-t8-data(5:4)

           accept wrk-hora-lancamento from time 
           compute wrk-hora-lancamento = wrk-hora-lancamento / 1000000
           move wrk-hora-lancamento to wrk-t8-hora

           display t8
           .
           
       trata-barra-funcoes-t8.
           move 1 to wrk-prgantnovo
           modify t8-pb-pesquisa enabled 0
           modify t8-pb-inclui   enabled 0

           if control-id = 125
              modify t8-pb-pesquisa enabled 1
           end-if

      *     if control-id = 28
      *        modify t8-pb-inclui   enabled 1
      *     end-if
           .

      *
       t8-Ef-wrk-t8-tipo-Bef-Procedure.
           perform trata-barra-funcoes-t8
           .
      *
       t8-Ef-wrk-t8-obs1-Bef-Procedure.
           perform trata-barra-funcoes-t8
           .
      *
       t8-Ef-wrk-t8-obs2-Bef-Procedure.
           perform trata-barra-funcoes-t8
           .
      *
       t8-Ef-wrk-t8-obs3-Bef-Procedure.
           perform trata-barra-funcoes-t8
           .
      *
       t8-Ef-wrk-t8-obs4-Bef-Procedure.
           perform trata-barra-funcoes-t8
           .
      *
       t8-Ef-wrk-t8-obs5-Bef-Procedure.
           perform trata-barra-funcoes-t8
           .
      *
       t8-Pb-grava-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t8-pb-grava bitmap-handle = tripao2-bmp
           modify t8-pb-grava style         = pbs-framed
           modify t8-pb-grava bitmap-number = 1
           .
      *
       t8-Pb-grava-Aft-Procedure.
           modify t8-pb-grava bitmap-handle = tripao2-bmp
           modify t8-pb-grava bitmap-number = 1
           modify t8-pb-grava flat
           .
      *
       t8-Pb-desiste-Bef-Procedure.
           perform trata-barra-funcoes    
           modify t8-pb-desiste bitmap-handle = tripao2-bmp
           modify t8-pb-desiste style         = pbs-framed
           modify t8-pb-desiste bitmap-number = 2
           .
      *
       t8-Pb-desiste-Aft-Procedure.
           modify t8-pb-desiste bitmap-handle = tripao2-bmp
           modify t8-pb-desiste bitmap-number = 2
           modify t8-pb-desiste flat
           .
      *
       t8-Pb-pesquisa-Link.
           if control-id = 125 |Tipo
              move zeros to wrk-tipo-t6
              perform acu-t6-routine

              evaluate wrk-tipo-t6
                 when 1
                    move 1 to wrk-t8-tipo
                    move 'Lançada'    to wrk-t8-nom-tipo
                 when 4
                    move 4 to wrk-t8-tipo
                    move 'Aguardando' to wrk-t8-nom-tipo
              end-evaluate
              modify t8-Ef-wrk-t8-tipo value wrk-t8-tipo
              modify t8-Ef-wrk-t8-nom-tipo value wrk-t8-nom-tipo
              inquire t8-Ef-wrk-t8-tipo id in control-id
              move 4 to accept-control
              exit paragraph
           end-if
           .
      *
       t8-Ef-wrk-t8-tipo-Aft-Procedure.
           if wrk-t8-tipo not = 1 and 4
              move 'Tipo Inválido.' to wrk-message-1
              perform mensagem
              move spaces to wrk-t8-nom-tipo
              modify t8-Ef-wrk-t8-nom-tipo value wrk-t8-nom-tipo
              inquire t8-Ef-wrk-t8-tipo id in control-id
              move 4 to accept-control
              exit paragraph
           end-if

           evaluate wrk-t8-tipo
              when 1
                 move 'Lançada'    to wrk-t8-nom-tipo
              when 4
                 move 'Aguardando' to wrk-t8-nom-tipo
           end-evaluate
           modify t8-Ef-wrk-t8-nom-tipo value wrk-t8-nom-tipo
           .
      *
       t8-Pb-grava-Link.
           perform Preenche-IFC01-CODIGO

           add 1 to wrk-contagem-gd4
   
           if wrk-contagem-gd4 = 1
              perform criar-temp-4
              if wrk-ok = "N"
                 exit paragraph
              end-if
           end-if

           initialize REG-T01-C074-4
           move IFC01-CODIGOz    to T01-C074-4-CODIGO
           move wrk-contagem-gd4 to T01-C074-4-PROGRESSIVO
           move wrk-t8-data      to T01-C074-4-DATA
           move wrk-t8-hora      to T01-C074-4-HORA
           move wrk-t8-tipo      to T01-C074-4-TIPO           
           move wrk-t8-obs1      to T01-C074-4-OBS1
           move wrk-t8-obs2      to T01-C074-4-OBS2
           move wrk-t8-obs3      to T01-C074-4-OBS3
           move wrk-t8-obs4      to T01-C074-4-OBS4
           move wrk-t8-obs5      to T01-C074-4-OBS5
           |Protocolo 54.639
           move USU-CODIGO       to T01-C074-4-OPERADOR
           |Fim

           write REG-T01-C074-4
           if not Valid-T01-C074-4
              move "Não foi possivel gravar o arquivo"  
                                               to wrk-message-1
              string "temporario. Status: " Stat-T01-C074-4
                                             into wrk-message-2
              move "N" to wrk-ok
              perform mensagem
           end-if

           perform acu-t8-exit
           .

       Grava-T01-C074-4.
           perform Preenche-IFC01-CODIGO

           |Verificação
           initialize REG-T01-C074-4
           move IFC01-CODIGOz     to T01-C074-4-CODIGO
           move wrk-contagem-gd4  to T01-C074-4-PROGRESSIVO
           read T01-C074-4 with no lock
           if valid-T01-C074-4
              if wrk-IFS01-TIPO = 'LANÇADA'
                 move 1 to IFS01-TIPO
              else
                 move 4 to IFS01-TIPO
              end-if

              move zeros to wrk-dt-inv1 
                            wrk-dt-inv2

              move T01-C074-4-DATA-R-DIA   to wrk-dt-inv1-d
              move T01-C074-4-DATA-R-MES   to wrk-dt-inv1-m
              move T01-C074-4-DATA-R-ANO   to wrk-dt-inv1-a
              move IFS01-DATSITUACAO-R-DIA to wrk-dt-inv2-d
              move IFS01-DATSITUACAO-R-MES to wrk-dt-inv2-m
              move IFS01-DATSITUACAO-R-ANO to wrk-dt-inv2-a

              if T01-C074-4-TIPO = IFS01-TIPO        and
                 wrk-dt-inv1     = wrk-dt-inv2       and
                 T01-C074-4-HORA = IFS01-HORSITUACAO
                 if T01-C074-4-OBS1 = IFS01-OBSERVACAO1 and
                    T01-C074-4-OBS2 = IFS01-OBSERVACAO2 and 
                    T01-C074-4-OBS3 = IFS01-OBSERVACAO3 and
                    T01-C074-4-OBS4 = IFS01-OBSERVACAO4 and 
                    T01-C074-4-OBS5 = IFS01-OBSERVACAO5
                    exit paragraph
                 else
                    accept wrk-data-inv from date YYYYMMDD

                    move wrk-data-inv-r-dia to IFS01-DATSITUACAO-R-DIA
                                               T01-C074-4-DATA-R-DIA
         
                    move wrk-data-inv-r-mes to IFS01-DATSITUACAO-R-MES
                                               T01-C074-4-DATA-R-MES
         
                    move wrk-data-inv-r-ano to IFS01-DATSITUACAO-R-ANO
                                               T01-C074-4-DATA-R-ANO
         
                    accept wrk-hora-lancamento from time 
                    compute wrk-hora-lancamento = 
                                           wrk-hora-lancamento / 1000000
                    move wrk-hora-lancamento to IFS01-HORSITUACAO
                                                T01-C074-4-HORA

                    move IFS01-OBSERVACAO1 to T01-C074-4-OBS1
                    move IFS01-OBSERVACAO2 to T01-C074-4-OBS2
                    move IFS01-OBSERVACAO3 to T01-C074-4-OBS3
                    move IFS01-OBSERVACAO4 to T01-C074-4-OBS4
                    move IFS01-OBSERVACAO5 to T01-C074-4-OBS5
                    |Protocolo 54.639
                    move IFS01-OPERADOR    to T01-C074-4-OPERADOR
                    |Fim
         
                    rewrite REG-T01-C074-4
                    if not Valid-T01-C074-4
                       move "Não foi possivel regravar o arquivo"  
                                                        to wrk-message-1
                       string "temporario. Status: " Stat-T01-C074-4
                                                      into wrk-message-2
                       move "N" to wrk-ok
                       perform mensagem
                    end-if
                    exit paragraph
                 end-if
              end-if
           else
              add 1 to wrk-contagem-gd4
   
              if wrk-contagem-gd4 = 1
                 perform criar-temp-4
                 if wrk-ok = "N"
                    exit paragraph
                 end-if
              end-if
   
              initialize REG-T01-C074-4
              move IFC01-CODIGOz     to T01-C074-4-CODIGO
              move wrk-contagem-gd4  to T01-C074-4-PROGRESSIVO
              move IFS01-DATSITUACAO to T01-C074-4-DATA
              move IFS01-HORSITUACAO to T01-C074-4-HORA
              if wrk-IFS01-TIPO = 'LANÇADA'
                 move 1 to T01-C074-4-TIPO
              else
                 move 4 to T01-C074-4-TIPO
              end-if
              
              move IFS01-OBSERVACAO1 to T01-C074-4-OBS1
              move IFS01-OBSERVACAO2 to T01-C074-4-OBS2
              move IFS01-OBSERVACAO3 to T01-C074-4-OBS3
              move IFS01-OBSERVACAO4 to T01-C074-4-OBS4
              move IFS01-OBSERVACAO5 to T01-C074-4-OBS5
              |Protocolo 54.639
              move IFS01-OPERADOR    to T01-C074-4-OPERADOR
              |Fim
   
              write REG-T01-C074-4
              if not Valid-T01-C074-4
                 move "Não foi possivel gravar o arquivo"  
                                                  to wrk-message-1
                 string "temporario. Status: " Stat-T01-C074-4
                                                into wrk-message-2
                 move "N" to wrk-ok
                 perform mensagem
              end-if
           end-if
           .  
           |Fim Protocolo 54.601/54.609

       
      *
       arq-usu-Write.
           write reg-usu 
           if not valid-arq-usu
              display message box "Erro na gravação do Usuário: " 
                 usu-codigo h"0a" "Status: " stat-arq-usu 
                 icon mb-error-icon title "Erro" 
           end-if                      
           .
      *
       arq-usu-Rewrite.
           rewrite reg-usu 
           if not valid-arq-usu
              display message box "Erro na regravação do Usuário: " 
                 usu-codigo h"0a" "Status: " stat-arq-usu 
                 icon mb-error-icon title "Erro" 
           end-if                       
           .
      *
       arq-usu-Delete-File-Record.
           display message box "Confirma exclusão do Usuário?"
              icon mb-warning-icon type mb-yes-no title "Atenção"
              giving return-code
           if return-code = 1
              delete arq-usu
              if not valid-arq-usu
                 display message box "Erro na exclusão do Usuário: " 
                    usu-codigo h"0a" "Status: " stat-arq-usu 
                    icon mb-error-icon title "Erro" 
              end-if
           end-if                      
           .
      ** 
      * call-error.
      *     SET ENVIRONMENT "TRANSLATE_TO_ANSI" TO 0
      *     initialize wrk-texto-msg
      *     string "Programa ( " wrk-codprg " ) não encontrado !" 
      *                              delimited by size into wrk-message-1
      *     set wrk-warning-type to true
      *     set wrk-ok-type      to true
      *     call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
      *                       wrk-message-1, wrk-Message-2, wrk-Message-3
      *     on overflow perform call-error end-call
      *     cancel "mensagem"
      *     .

      *
       arq-usu-prg-Write.
           write reg-usu-prg
           if not Valid-usu-prg
              display message box "Erro na gravação dos Programas: " 
                 usu-prg-codprg h"0a" "Status: " stat-usu-prg
                 icon mb-error-icon title "Erro" 
           end-if
           .
      *
       arq-usu-prg-Rewrite.
           rewrite reg-usu-prg
           if not Valid-usu-prg
              display message box "Erro na regravação do Programa: " 
                 usu-prg-codprg h"0a" "Status: " stat-usu-prg
                 icon mb-error-icon title "Erro" 
           end-if           
           .
      *
       arq-usu-prg-Delete-File-Record.
           display message box "Confirma exclusão do Programa?"
              icon mb-warning-icon type mb-yes-no title "Atenção"
              giving return-code
           if return-code = 1
              delete arq-usu-prg
              if not Valid-usu-prg
                 display message box "Erro na exclusão do Programa: " 
                 usu-prg-codprg h"0a" "Status: " stat-usu-prg
                 icon mb-error-icon title "Erro" 
              end-if
           end-if                
           .

      *
       arq-prg-write.
           write reg-prg
           if not valid-arq-prg
              display message box "Erro na gravação do Programa: " 
                 prg-codigo h"0a" "Status: " stat-arq-prg
                 icon mb-error-icon title "Erro" 
           else
              display message box "Programa: " prg-codigo 
                                  " gravado com sucesso"
           end-if            
           .
      *
       arq-prg-rewrite.
           rewrite reg-prg 
           if not valid-arq-prg
              display message box "Erro na regravação do Programa: " 
                 prg-codigo h"0a" "Status: " stat-arq-prg
                 icon mb-error-icon title "Erro" 
           else
              display message box "Programa: " prg-codigo 
                                  " regravado com sucesso"
           end-if            
           .
      *
       arq-prg-Delete-File-Record.
           display message box "Confirma exclusão do Programa ?"
              icon mb-warning-icon type mb-yes-no title "Atenção"
              giving return-code
           if return-code = 1
              delete arq-prg
              if not valid-arq-prg
                 display message box "Erro na exclusão do Programa: " 
                    prg-codigo h"0a" "Status: " stat-arq-prg
                    icon mb-error-icon title "Erro" 
              else
              display message box "Programa: " prg-codigo 
                                  " excluído com sucesso"
              end-if
           end-if                                 
           .


      *
       arq-cid01-Write.
           write REG-cid01
           if not valid-arq-cid01
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              string 
                 "Erro na gravação da Cidade: " 
                      cid01-chave into wrk-message-1 
              string "Status: " stat-arq-cid01 into wrk-message-2
 
              set wrk-error-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
           end-if
           .
      *
       arq-cid01-Rewrite.
           rewrite REG-cid01
           if not valid-arq-cid01
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              string 
                 "Erro na regravação da Cidade: " 
                      cid01-chave into wrk-message-1 
              string "Status: " stat-arq-cid01 into wrk-message-2
 
              set wrk-error-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
           end-if
           .
      *
       arq-cid01-Delete-File-Record.
           move "Confirma exclusão da Cidade?" 
                                                       to wrk-message-1
           set wrk-warning-type to true
           set wrk-yes-no-type  to true
           Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem"
           
           if wrk-response = 1
              delete arq-cid01
              if not valid-arq-cid01
                 string "Erro na exclusão da Cidade: " 
                        cid01-chave into wrk-message-1 
                 string "Status: " stat-arq-cid01 into wrk-message-2
 
                 set wrk-error-type to true
                 set wrk-ok-type      to true
                 Call "mensagem" 
                    Using wrk-Message-Type, wrk-Response-Type, 
                          wrk-message-1, wrk-Message-2, wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"
              end-if
           end-if
           .

      *
       arq-uni15-Write.
           write REG-uni15
           if not valid-arq-uni15
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              string 
                 "Erro na gravação do arq-uni15: " 
                     uni15-codigo into wrk-message-1 
              string "Status: " stat-arq-uni15 into wrk-message-2
 
              set wrk-error-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
           .
      *
       arq-uni15-Rewrite.
           rewrite REG-uni15
           if not valid-arq-uni15
              move 1 to  wrk-prgantnovo
              initialize wrk-texto-msg
              string 
                 "Erro na regravação do arq-uni15: " 
                      uni15-codigo into wrk-message-1 
              string "Status: " stat-arq-uni15 into wrk-message-2
 
              set wrk-error-type to true
              set wrk-ok-type      to true
              Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
              on overflow perform call-error end-call
              Cancel "mensagem"
           end-if
           .
      *
       arq-uni15-Delete-File-Record.
           move "Confirma exclusão do Registro?" 
                                                       to wrk-message-1
           set wrk-warning-type to true
           set wrk-yes-no-type  to true
           Call "mensagem" Using wrk-Message-Type, wrk-Response-Type, 
                            wrk-message-1, wrk-Message-2, wrk-Message-3
           on overflow perform call-error end-call
           Cancel "mensagem"
           
           if wrk-response = 1
              delete arq-uni15
              if not valid-arq-uni15
                 string "Erro na exclusão do arq-uni15: " 
                        uni15-codigo into wrk-message-1 
                 string "Status: " stat-arq-uni15 into wrk-message-2
 
                 set wrk-error-type to true
                 set wrk-ok-type      to true
                 Call "mensagem" 
                    Using wrk-Message-Type, wrk-Response-Type, 
                          wrk-message-1, wrk-Message-2, wrk-Message-3
                 on overflow perform call-error end-call
                 Cancel "mensagem"                
              end-if
           end-if
           .

